'use strict';

var cov_2kdautmfos = (function() {
  var path =
    '/Users/guy/Work/Leo/leo/BotFramework-WebChat/packages/component/src/Utils/downscaleImageToDataURLUsingWorker.js';
  var hash = 'edcc56aec2f6f650a247782acc3a93530ae6a095';
  var global = new Function('return this')();
  var gcv = '__coverage__';
  var coverageData = {
    path:
      '/Users/guy/Work/Leo/leo/BotFramework-WebChat/packages/component/src/Utils/downscaleImageToDataURLUsingWorker.js',
    statementMap: {
      '0': {
        start: {
          line: 6,
          column: 15
        },
        end: {
          line: 6,
          column: 71
        }
      },
      '1': {
        start: {
          line: 7,
          column: 14
        },
        end: {
          line: 7,
          column: 46
        }
      },
      '2': {
        start: {
          line: 9,
          column: 2
        },
        end: {
          line: 16,
          column: 5
        }
      },
      '3': {
        start: {
          line: 10,
          column: 19
        },
        end: {
          line: 10,
          column: 34
        }
      },
      '4': {
        start: {
          line: 12,
          column: 4
        },
        end: {
          line: 12,
          column: 81
        }
      },
      '5': {
        start: {
          line: 12,
          column: 45
        },
        end: {
          line: 12,
          column: 80
        }
      },
      '6': {
        start: {
          line: 13,
          column: 4
        },
        end: {
          line: 13,
          column: 73
        }
      },
      '7': {
        start: {
          line: 13,
          column: 37
        },
        end: {
          line: 13,
          column: 72
        }
      },
      '8': {
        start: {
          line: 15,
          column: 4
        },
        end: {
          line: 15,
          column: 36
        }
      },
      '9': {
        start: {
          line: 24,
          column: 2
        },
        end: {
          line: 35,
          column: 3
        }
      },
      '10': {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 25,
          column: 33
        }
      },
      '11': {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 27,
          column: 35
        }
      },
      '12': {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 33
        }
      },
      '13': {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 34,
          column: 7
        }
      },
      '14': {
        start: {
          line: 32,
          column: 6
        },
        end: {
          line: 32,
          column: 27
        }
      },
      '15': {
        start: {
          line: 33,
          column: 6
        },
        end: {
          line: 33,
          column: 25
        }
      },
      '16': {
        start: {
          line: 37,
          column: 2
        },
        end: {
          line: 37,
          column: 16
        }
      },
      '17': {
        start: {
          line: 44,
          column: 21
        },
        end: {
          line: 67,
          column: 2
        }
      },
      '18': {
        start: {
          line: 46,
          column: 4
        },
        end: {
          line: 48,
          column: 69
        }
      },
      '19': {
        start: {
          line: 51,
          column: 2
        },
        end: {
          line: 58,
          column: 3
        }
      },
      '20': {
        start: {
          line: 52,
          column: 4
        },
        end: {
          line: 57,
          column: 5
        }
      },
      '21': {
        start: {
          line: 53,
          column: 6
        },
        end: {
          line: 53,
          column: 49
        }
      },
      '22': {
        start: {
          line: 54,
          column: 6
        },
        end: {
          line: 54,
          column: 50
        }
      },
      '23': {
        start: {
          line: 56,
          column: 6
        },
        end: {
          line: 56,
          column: 51
        }
      },
      '24': {
        start: {
          line: 60,
          column: 2
        },
        end: {
          line: 66,
          column: 4
        }
      },
      '25': {
        start: {
          line: 70,
          column: 2
        },
        end: {
          line: 91,
          column: 5
        }
      },
      '26': {
        start: {
          line: 71,
          column: 29
        },
        end: {
          line: 71,
          column: 49
        }
      },
      '27': {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 86,
          column: 6
        }
      },
      '28': {
        start: {
          line: 74,
          column: 6
        },
        end: {
          line: 82,
          column: 7
        }
      },
      '29': {
        start: {
          line: 75,
          column: 20
        },
        end: {
          line: 75,
          column: 44
        }
      },
      '30': {
        start: {
          line: 77,
          column: 8
        },
        end: {
          line: 77,
          column: 32
        }
      },
      '31': {
        start: {
          line: 79,
          column: 8
        },
        end: {
          line: 79,
          column: 20
        }
      },
      '32': {
        start: {
          line: 81,
          column: 8
        },
        end: {
          line: 81,
          column: 24
        }
      },
      '33': {
        start: {
          line: 84,
          column: 6
        },
        end: {
          line: 84,
          column: 20
        }
      },
      '34': {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 85,
          column: 20
        }
      },
      '35': {
        start: {
          line: 88,
          column: 4
        },
        end: {
          line: 90,
          column: 6
        }
      },
      '36': {
        start: {
          line: 89,
          column: 6
        },
        end: {
          line: 89,
          column: 99
        }
      }
    },
    fnMap: {
      '0': {
        name: 'createWorker',
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 21
          }
        },
        loc: {
          start: {
            line: 5,
            column: 24
          },
          end: {
            line: 17,
            column: 1
          }
        },
        line: 5
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 9,
            column: 21
          },
          end: {
            line: 9,
            column: 22
          }
        },
        loc: {
          start: {
            line: 9,
            column: 42
          },
          end: {
            line: 14,
            column: 3
          }
        },
        line: 9
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 12,
            column: 21
          },
          end: {
            line: 12,
            column: 22
          }
        },
        loc: {
          start: {
            line: 12,
            column: 45
          },
          end: {
            line: 12,
            column: 80
          }
        },
        line: 12
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 13,
            column: 23
          },
          end: {
            line: 13,
            column: 24
          }
        },
        loc: {
          start: {
            line: 13,
            column: 37
          },
          end: {
            line: 13,
            column: 72
          }
        },
        line: 13
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 14,
            column: 13
          },
          end: {
            line: 14,
            column: 14
          }
        },
        loc: {
          start: {
            line: 14,
            column: 19
          },
          end: {
            line: 16,
            column: 3
          }
        },
        line: 14
      },
      '5': {
        name: 'getWorker',
        decl: {
          start: {
            line: 21,
            column: 15
          },
          end: {
            line: 21,
            column: 24
          }
        },
        loc: {
          start: {
            line: 21,
            column: 27
          },
          end: {
            line: 38,
            column: 1
          }
        },
        line: 21
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 30,
            column: 37
          },
          end: {
            line: 30,
            column: 38
          }
        },
        loc: {
          start: {
            line: 30,
            column: 43
          },
          end: {
            line: 34,
            column: 5
          }
        },
        line: 30
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 44,
            column: 32
          },
          end: {
            line: 44,
            column: 33
          }
        },
        loc: {
          start: {
            line: 44,
            column: 38
          },
          end: {
            line: 67,
            column: 1
          }
        },
        line: 44
      },
      '8': {
        name: 'downscaleImageToDataURLUsingWorker',
        decl: {
          start: {
            line: 69,
            column: 24
          },
          end: {
            line: 69,
            column: 58
          }
        },
        loc: {
          start: {
            line: 69,
            column: 101
          },
          end: {
            line: 92,
            column: 1
          }
        },
        line: 69
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 70,
            column: 21
          },
          end: {
            line: 70,
            column: 22
          }
        },
        loc: {
          start: {
            line: 70,
            column: 42
          },
          end: {
            line: 91,
            column: 3
          }
        },
        line: 70
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 73,
            column: 22
          },
          end: {
            line: 73,
            column: 23
          }
        },
        loc: {
          start: {
            line: 73,
            column: 55
          },
          end: {
            line: 86,
            column: 5
          }
        },
        line: 73
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 88,
            column: 61
          },
          end: {
            line: 88,
            column: 62
          }
        },
        loc: {
          start: {
            line: 89,
            column: 6
          },
          end: {
            line: 89,
            column: 99
          }
        },
        line: 89
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 12,
            column: 52
          },
          end: {
            line: 12,
            column: 79
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 12,
              column: 52
            },
            end: {
              line: 12,
              column: 57
            }
          },
          {
            start: {
              line: 12,
              column: 61
            },
            end: {
              line: 12,
              column: 79
            }
          }
        ],
        line: 12
      },
      '1': {
        loc: {
          start: {
            line: 13,
            column: 37
          },
          end: {
            line: 13,
            column: 72
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 13,
              column: 37
            },
            end: {
              line: 13,
              column: 53
            }
          },
          {
            start: {
              line: 13,
              column: 57
            },
            end: {
              line: 13,
              column: 72
            }
          }
        ],
        line: 13
      },
      '2': {
        loc: {
          start: {
            line: 24,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 24,
              column: 2
            },
            end: {
              line: 35,
              column: 3
            }
          },
          {
            start: {
              line: 24,
              column: 2
            },
            end: {
              line: 35,
              column: 3
            }
          }
        ],
        line: 24
      },
      '3': {
        loc: {
          start: {
            line: 46,
            column: 4
          },
          end: {
            line: 48,
            column: 69
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 46,
              column: 4
            },
            end: {
              line: 46,
              column: 49
            }
          },
          {
            start: {
              line: 47,
              column: 5
            },
            end: {
              line: 47,
              column: 74
            }
          },
          {
            start: {
              line: 48,
              column: 6
            },
            end: {
              line: 48,
              column: 68
            }
          }
        ],
        line: 46
      },
      '4': {
        loc: {
          start: {
            line: 51,
            column: 2
          },
          end: {
            line: 58,
            column: 3
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 51,
              column: 2
            },
            end: {
              line: 58,
              column: 3
            }
          },
          {
            start: {
              line: 51,
              column: 2
            },
            end: {
              line: 58,
              column: 3
            }
          }
        ],
        line: 51
      },
      '5': {
        loc: {
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 65,
            column: 40
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 61,
              column: 4
            },
            end: {
              line: 61,
              column: 51
            }
          },
          {
            start: {
              line: 62,
              column: 4
            },
            end: {
              line: 62,
              column: 48
            }
          },
          {
            start: {
              line: 63,
              column: 4
            },
            end: {
              line: 63,
              column: 22
            }
          },
          {
            start: {
              line: 64,
              column: 4
            },
            end: {
              line: 64,
              column: 40
            }
          },
          {
            start: {
              line: 65,
              column: 4
            },
            end: {
              line: 65,
              column: 40
            }
          }
        ],
        line: 61
      },
      '6': {
        loc: {
          start: {
            line: 74,
            column: 6
          },
          end: {
            line: 82,
            column: 7
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 74,
              column: 6
            },
            end: {
              line: 82,
              column: 7
            }
          },
          {
            start: {
              line: 74,
              column: 6
            },
            end: {
              line: 82,
              column: 7
            }
          }
        ],
        line: 74
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0, 0],
      '4': [0, 0],
      '5': [0, 0, 0, 0, 0],
      '6': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184',
    hash: 'edcc56aec2f6f650a247782acc3a93530ae6a095'
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return (coverage[path] = coverageData);
})();

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = downscaleImageToDataURLUsingWorker;
exports.checkSupport = void 0;

var _blobToArrayBuffer = _interopRequireDefault(require('./blobToArrayBuffer'));

var _memoizeOne = _interopRequireDefault(require('memoize-one'));

var _downscaleImageToDataURLUsingWorker = _interopRequireDefault(
  require('./downscaleImageToDataURLUsingWorker.worker')
);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
}

function _nonIterableRest() {
  throw new TypeError('Invalid attempt to destructure non-iterable instance');
}

function _iterableToArrayLimit(arr, i) {
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;
  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);
      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i['return'] != null) _i['return']();
    } finally {
      if (_d) throw _e;
    }
  }
  return _arr;
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }
  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function() {
    var self = this,
      args = arguments;
    return new Promise(function(resolve, reject) {
      var gen = fn.apply(self, args);
      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);
      }
      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);
      }
      _next(undefined);
    });
  };
}

function createWorker() {
  cov_2kdautmfos.f[0]++;
  var blob =
    (cov_2kdautmfos.s[0]++,
    new Blob(['('.concat(_downscaleImageToDataURLUsingWorker.default, ')()')], {
      type: 'text/javascript'
    }));
  var url = (cov_2kdautmfos.s[1]++, window.URL.createObjectURL(blob));
  cov_2kdautmfos.s[2]++;
  return new Promise(function(resolve, reject) {
    cov_2kdautmfos.f[1]++;
    var worker = (cov_2kdautmfos.s[3]++, new Worker(url));
    cov_2kdautmfos.s[4]++;

    worker.onerror = function(_ref) {
      var error = _ref.error,
        message = _ref.message;
      cov_2kdautmfos.f[2]++;
      cov_2kdautmfos.s[5]++;
      return reject((cov_2kdautmfos.b[0][0]++, error) || (cov_2kdautmfos.b[0][1]++, new Error(message)));
    };

    cov_2kdautmfos.s[6]++;

    worker.onmessage = function(_ref2) {
      var data = _ref2.data;
      cov_2kdautmfos.f[3]++;
      cov_2kdautmfos.s[7]++;
      return (cov_2kdautmfos.b[1][0]++, data === 'ready') && (cov_2kdautmfos.b[1][1]++, resolve(worker));
    };
  }).finally(function() {
    cov_2kdautmfos.f[4]++;
    cov_2kdautmfos.s[8]++;
    window.URL.revokeObjectURL(url);
  });
}

var workerPromise;

function getWorker() {
  return _getWorker.apply(this, arguments);
} // We are using a lazy-check because:
// 1. OffscreenCanvas.getContext has a toll
// 2. Developers could bring polyfills

function _getWorker() {
  _getWorker = _asyncToGenerator(
    /*#__PURE__*/
    regeneratorRuntime.mark(function _callee() {
      var worker;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch ((_context.prev = _context.next)) {
            case 0:
              cov_2kdautmfos.f[5]++;
              cov_2kdautmfos.s[9]++;

              if (!workerPromise) {
                _context.next = 10;
                break;
              }

              cov_2kdautmfos.b[2][0]++;
              cov_2kdautmfos.s[10]++;
              _context.next = 7;
              return workerPromise;

            case 7:
              worker = _context.sent;
              _context.next = 19;
              break;

            case 10:
              cov_2kdautmfos.b[2][1]++;
              cov_2kdautmfos.s[11]++;
              workerPromise = createWorker();
              cov_2kdautmfos.s[12]++;
              _context.next = 16;
              return workerPromise;

            case 16:
              worker = _context.sent;
              cov_2kdautmfos.s[13]++;
              worker.addEventListener('error', function() {
                cov_2kdautmfos.f[6]++;
                cov_2kdautmfos.s[14]++;
                // Current worker errored out, will create a new worker next time.
                workerPromise = null;
                cov_2kdautmfos.s[15]++;
                worker.terminate();
              });

            case 19:
              cov_2kdautmfos.s[16]++;
              return _context.abrupt('return', worker);

            case 21:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee);
    })
  );
  return _getWorker.apply(this, arguments);
}

var checkSupport =
  (cov_2kdautmfos.s[17]++,
  (0, _memoizeOne.default)(function() {
    cov_2kdautmfos.f[7]++;
    var hasOffscreenCanvas =
      (cov_2kdautmfos.s[18]++,
      (cov_2kdautmfos.b[3][0]++, typeof window.OffscreenCanvas !== 'undefined') &&
        ((cov_2kdautmfos.b[3][1]++, typeof window.OffscreenCanvas.prototype.convertToBlob !== 'undefined') ||
          (cov_2kdautmfos.b[3][2]++, typeof window.OffscreenCanvas.prototype.toBlob !== 'undefined')));
    var isOffscreenCanvasSupportGetContext2D;
    cov_2kdautmfos.s[19]++;

    if (hasOffscreenCanvas) {
      cov_2kdautmfos.b[4][0]++;
      cov_2kdautmfos.s[20]++;

      try {
        cov_2kdautmfos.s[21]++;
        new OffscreenCanvas(1, 1).getContext('2d');
        cov_2kdautmfos.s[22]++;
        isOffscreenCanvasSupportGetContext2D = true;
      } catch (err) {
        cov_2kdautmfos.s[23]++;
        isOffscreenCanvasSupportGetContext2D = false;
      }
    } else {
      cov_2kdautmfos.b[4][1]++;
    }

    cov_2kdautmfos.s[24]++;
    return (
      (cov_2kdautmfos.b[5][0]++, typeof window.createImageBitmap !== 'undefined') &&
      (cov_2kdautmfos.b[5][1]++, typeof window.MessageChannel !== 'undefined') &&
      (cov_2kdautmfos.b[5][2]++, hasOffscreenCanvas) &&
      (cov_2kdautmfos.b[5][3]++, isOffscreenCanvasSupportGetContext2D) &&
      (cov_2kdautmfos.b[5][4]++, typeof window.Worker !== 'undefined')
    );
  }));
exports.checkSupport = checkSupport;

function downscaleImageToDataURLUsingWorker(blob, maxWidth, maxHeight, type, quality) {
  cov_2kdautmfos.f[8]++;
  cov_2kdautmfos.s[25]++;
  return new Promise(function(resolve, reject) {
    cov_2kdautmfos.f[9]++;

    var _ref3 = (cov_2kdautmfos.s[26]++, new MessageChannel()),
      port1 = _ref3.port1,
      port2 = _ref3.port2;

    cov_2kdautmfos.s[27]++;

    port1.onmessage = function(_ref4) {
      var _ref4$data = _ref4.data,
        error = _ref4$data.error,
        result = _ref4$data.result;
      cov_2kdautmfos.f[10]++;
      cov_2kdautmfos.s[28]++;

      if (error) {
        cov_2kdautmfos.b[6][0]++;
        var err = (cov_2kdautmfos.s[29]++, new Error(error.message));
        cov_2kdautmfos.s[30]++;
        err.stack = error.stack;
        cov_2kdautmfos.s[31]++;
        reject(err);
      } else {
        cov_2kdautmfos.b[6][1]++;
        cov_2kdautmfos.s[32]++;
        resolve(result);
      }

      cov_2kdautmfos.s[33]++;
      port1.close();
      cov_2kdautmfos.s[34]++;
      port2.close();
    };

    cov_2kdautmfos.s[35]++;
    Promise.all([(0, _blobToArrayBuffer.default)(blob), getWorker()]).then(function(_ref5) {
      var _ref6 = _slicedToArray(_ref5, 2),
        arrayBuffer = _ref6[0],
        worker = _ref6[1];

      cov_2kdautmfos.f[11]++;
      cov_2kdautmfos.s[36]++;
      return worker.postMessage(
        {
          arrayBuffer: arrayBuffer,
          maxHeight: maxHeight,
          maxWidth: maxWidth,
          quality: quality,
          type: type
        },
        [arrayBuffer, port2]
      );
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9VdGlscy9kb3duc2NhbGVJbWFnZVRvRGF0YVVSTFVzaW5nV29ya2VyLmpzIl0sIm5hbWVzIjpbImNyZWF0ZVdvcmtlciIsImJsb2IiLCJCbG9iIiwid29ya2VyIiwidHlwZSIsInVybCIsIndpbmRvdyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiV29ya2VyIiwib25lcnJvciIsImVycm9yIiwibWVzc2FnZSIsIkVycm9yIiwib25tZXNzYWdlIiwiZGF0YSIsImZpbmFsbHkiLCJyZXZva2VPYmplY3RVUkwiLCJ3b3JrZXJQcm9taXNlIiwiZ2V0V29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRlcm1pbmF0ZSIsImNoZWNrU3VwcG9ydCIsImhhc09mZnNjcmVlbkNhbnZhcyIsIk9mZnNjcmVlbkNhbnZhcyIsInByb3RvdHlwZSIsImNvbnZlcnRUb0Jsb2IiLCJ0b0Jsb2IiLCJpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRHZXRDb250ZXh0MkQiLCJnZXRDb250ZXh0IiwiZXJyIiwiY3JlYXRlSW1hZ2VCaXRtYXAiLCJNZXNzYWdlQ2hhbm5lbCIsImRvd25zY2FsZUltYWdlVG9EYXRhVVJMVXNpbmdXb3JrZXIiLCJtYXhXaWR0aCIsIm1heEhlaWdodCIsInF1YWxpdHkiLCJwb3J0MSIsInBvcnQyIiwicmVzdWx0Iiwic3RhY2siLCJjbG9zZSIsImFsbCIsInRoZW4iLCJhcnJheUJ1ZmZlciIsInBvc3RNZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLFNBQVNBLFlBQVQsR0FBd0I7QUFBQTtBQUN0QixNQUFNQyxJQUFJ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QUFBQSxLQUFLLENBQUNHLEtBQU47QUFDRCxLQWJEOztBQUhzQztBQWtCdENuQyxJQUFBQSxPQUFPLENBQUNvQyxHQUFSLENBQVksQ0FBQyxnQ0FBa0I1QyxJQUFsQixDQUFELEVBQTBCcUIsU0FBUyxFQUFuQyxDQUFaLEVBQW9Ed0IsSUFBcEQsQ0FBeUQsaUJBQ3ZEO0FBQUE7QUFBQSxVQUR5REMsV0FDekQ7QUFBQSxVQURzRTVDLE1BQ3RFOztBQUFBO0FBQUE7QUFBQSxhQUFBQSxNQUFNLENBQUM2QyxXQUFQLENBQW1CO0FBQUVELFFBQUFBLFdBQVcsRUFBWEEsV0FBRjtBQUFlVCxRQUFBQSxTQUFTLEVBQVRBLFNBQWY7QUFBMEJELFFBQUFBLFFBQVEsRUFBUkEsUUFBMUI7QUFBb0NFLFFBQUFBLE9BQU8sRUFBUEEsT0FBcEM7QUFBNkNuQyxRQUFBQSxJQUFJLEVBQUpBO0FBQTdDLE9BQW5CLEVBQXdFLENBQUMyQyxXQUFELEVBQWNOLEtBQWQsQ0FBeEU7QUFBNkYsS0FEL0Y7QUFHRCxHQXJCTSxDQUFQO0FBc0JEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJsb2JUb0FycmF5QnVmZmVyIGZyb20gJy4vYmxvYlRvQXJyYXlCdWZmZXInO1xuaW1wb3J0IG1lbW9pemVPbmUgZnJvbSAnbWVtb2l6ZS1vbmUnO1xuaW1wb3J0IHdvcmtlciBmcm9tICcuL2Rvd25zY2FsZUltYWdlVG9EYXRhVVJMVXNpbmdXb3JrZXIud29ya2VyJztcblxuZnVuY3Rpb24gY3JlYXRlV29ya2VyKCkge1xuICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2AoJHt3b3JrZXJ9KSgpYF0sIHsgdHlwZTogJ3RleHQvamF2YXNjcmlwdCcgfSk7XG4gIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3Qgd29ya2VyID0gbmV3IFdvcmtlcih1cmwpO1xuXG4gICAgd29ya2VyLm9uZXJyb3IgPSAoeyBlcnJvciwgbWVzc2FnZSB9KSA9PiByZWplY3QoZXJyb3IgfHwgbmV3IEVycm9yKG1lc3NhZ2UpKTtcbiAgICB3b3JrZXIub25tZXNzYWdlID0gKHsgZGF0YSB9KSA9PiBkYXRhID09PSAncmVhZHknICYmIHJlc29sdmUod29ya2VyKTtcbiAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcbiAgfSk7XG59XG5cbmxldCB3b3JrZXJQcm9taXNlO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRXb3JrZXIoKSB7XG4gIGxldCB3b3JrZXI7XG5cbiAgaWYgKHdvcmtlclByb21pc2UpIHtcbiAgICB3b3JrZXIgPSBhd2FpdCB3b3JrZXJQcm9taXNlO1xuICB9IGVsc2Uge1xuICAgIHdvcmtlclByb21pc2UgPSBjcmVhdGVXb3JrZXIoKTtcblxuICAgIHdvcmtlciA9IGF3YWl0IHdvcmtlclByb21pc2U7XG4gICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgLy8gQ3VycmVudCB3b3JrZXIgZXJyb3JlZCBvdXQsIHdpbGwgY3JlYXRlIGEgbmV3IHdvcmtlciBuZXh0IHRpbWUuXG4gICAgICB3b3JrZXJQcm9taXNlID0gbnVsbDtcbiAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB3b3JrZXI7XG59XG5cbi8vIFdlIGFyZSB1c2luZyBhIGxhenktY2hlY2sgYmVjYXVzZTpcbi8vIDEuIE9mZnNjcmVlbkNhbnZhcy5nZXRDb250ZXh0IGhhcyBhIHRvbGxcbi8vIDIuIERldmVsb3BlcnMgY291bGQgYnJpbmcgcG9seWZpbGxzXG5cbmNvbnN0IGNoZWNrU3VwcG9ydCA9IG1lbW9pemVPbmUoKCkgPT4ge1xuICBjb25zdCBoYXNPZmZzY3JlZW5DYW52YXMgPVxuICAgIHR5cGVvZiB3aW5kb3cuT2Zmc2NyZWVuQ2FudmFzICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICh0eXBlb2Ygd2luZG93Lk9mZnNjcmVlbkNhbnZhcy5wcm90b3R5cGUuY29udmVydFRvQmxvYiAhPT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgIHR5cGVvZiB3aW5kb3cuT2Zmc2NyZWVuQ2FudmFzLnByb3RvdHlwZS50b0Jsb2IgIT09ICd1bmRlZmluZWQnKTtcbiAgbGV0IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydEdldENvbnRleHQyRDtcblxuICBpZiAoaGFzT2Zmc2NyZWVuQ2FudmFzKSB7XG4gICAgdHJ5IHtcbiAgICAgIG5ldyBPZmZzY3JlZW5DYW52YXMoMSwgMSkuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydEdldENvbnRleHQyRCA9IHRydWU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRHZXRDb250ZXh0MkQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gKFxuICAgIHR5cGVvZiB3aW5kb3cuY3JlYXRlSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmXG4gICAgdHlwZW9mIHdpbmRvdy5NZXNzYWdlQ2hhbm5lbCAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICBoYXNPZmZzY3JlZW5DYW52YXMgJiZcbiAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRHZXRDb250ZXh0MkQgJiZcbiAgICB0eXBlb2Ygd2luZG93LldvcmtlciAhPT0gJ3VuZGVmaW5lZCdcbiAgKTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkb3duc2NhbGVJbWFnZVRvRGF0YVVSTFVzaW5nV29ya2VyKGJsb2IsIG1heFdpZHRoLCBtYXhIZWlnaHQsIHR5cGUsIHF1YWxpdHkpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG5cbiAgICBwb3J0MS5vbm1lc3NhZ2UgPSAoeyBkYXRhOiB7IGVycm9yLCByZXN1bHQgfSB9KSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UpO1xuXG4gICAgICAgIGVyci5zdGFjayA9IGVycm9yLnN0YWNrO1xuXG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgfVxuXG4gICAgICBwb3J0MS5jbG9zZSgpO1xuICAgICAgcG9ydDIuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgUHJvbWlzZS5hbGwoW2Jsb2JUb0FycmF5QnVmZmVyKGJsb2IpLCBnZXRXb3JrZXIoKV0pLnRoZW4oKFthcnJheUJ1ZmZlciwgd29ya2VyXSkgPT5cbiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7IGFycmF5QnVmZmVyLCBtYXhIZWlnaHQsIG1heFdpZHRoLCBxdWFsaXR5LCB0eXBlIH0sIFthcnJheUJ1ZmZlciwgcG9ydDJdKVxuICAgICk7XG4gIH0pO1xufVxuXG5leHBvcnQgeyBjaGVja1N1cHBvcnQgfTtcbiJdfQ==
