'use strict';

var cov_1axss8t0b2 = (function() {
  var path = '/home/guy/leo/BotFramework-WebChat/packages/component/src/Utils/TypeFocusSink/FocusBox.js';
  var hash = '1b8484c46f5c93a752821229ef0d5eb4f8532b32';
  var global = new Function('return this')();
  var gcv = '__coverage__';
  var coverageData = {
    path: '/home/guy/leo/BotFramework-WebChat/packages/component/src/Utils/TypeFocusSink/FocusBox.js',
    statementMap: {
      '0': {
        start: {
          line: 11,
          column: 22
        },
        end: {
          line: 11,
          column: 36
        }
      },
      '1': {
        start: {
          line: 13,
          column: 17
        },
        end: {
          line: 61,
          column: 1
        }
      },
      '2': {
        start: {
          line: 14,
          column: 30
        },
        end: {
          line: 14,
          column: 42
        }
      },
      '3': {
        start: {
          line: 15,
          column: 30
        },
        end: {
          line: 18,
          column: 4
        }
      },
      '4': {
        start: {
          line: 15,
          column: 44
        },
        end: {
          line: 15,
          column: 83
        }
      },
      '5': {
        start: {
          line: 20,
          column: 18
        },
        end: {
          line: 25,
          column: 3
        }
      },
      '6': {
        start: {
          line: 21,
          column: 11
        },
        end: {
          line: 23,
          column: 5
        }
      },
      '7': {
        start: {
          line: 27,
          column: 16
        },
        end: {
          line: 31,
          column: 27
        }
      },
      '8': {
        start: {
          line: 28,
          column: 24
        },
        end: {
          line: 28,
          column: 43
        }
      },
      '9': {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 31
        }
      },
      '10': {
        start: {
          line: 33,
          column: 31
        },
        end: {
          line: 52,
          column: 3
        }
      },
      '11': {
        start: {
          line: 35,
          column: 56
        },
        end: {
          line: 35,
          column: 61
        }
      },
      '12': {
        start: {
          line: 36,
          column: 23
        },
        end: {
          line: 36,
          column: 42
        }
      },
      '13': {
        start: {
          line: 38,
          column: 6
        },
        end: {
          line: 43,
          column: 7
        }
      },
      '14': {
        start: {
          line: 42,
          column: 8
        },
        end: {
          line: 42,
          column: 15
        }
      },
      '15': {
        start: {
          line: 45,
          column: 6
        },
        end: {
          line: 49,
          column: 7
        }
      },
      '16': {
        start: {
          line: 46,
          column: 8
        },
        end: {
          line: 46,
          column: 32
        }
      },
      '17': {
        start: {
          line: 48,
          column: 8
        },
        end: {
          line: 48,
          column: 16
        }
      },
      '18': {
        start: {
          line: 54,
          column: 2
        },
        end: {
          line: 60,
          column: 4
        }
      },
      '19': {
        start: {
          line: 63,
          column: 0
        },
        end: {
          line: 66,
          column: 2
        }
      },
      '20': {
        start: {
          line: 68,
          column: 0
        },
        end: {
          line: 76,
          column: 2
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 13,
            column: 17
          },
          end: {
            line: 13,
            column: 18
          }
        },
        loc: {
          start: {
            line: 13,
            column: 92
          },
          end: {
            line: 61,
            column: 1
          }
        },
        line: 13
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 15,
            column: 38
          },
          end: {
            line: 15,
            column: 39
          }
        },
        loc: {
          start: {
            line: 15,
            column: 44
          },
          end: {
            line: 15,
            column: 83
          }
        },
        line: 15
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 21,
            column: 4
          },
          end: {
            line: 21,
            column: 5
          }
        },
        loc: {
          start: {
            line: 21,
            column: 11
          },
          end: {
            line: 23,
            column: 5
          }
        },
        line: 21
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 27,
            column: 28
          },
          end: {
            line: 27,
            column: 29
          }
        },
        loc: {
          start: {
            line: 27,
            column: 34
          },
          end: {
            line: 31,
            column: 3
          }
        },
        line: 27
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 34,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        },
        loc: {
          start: {
            line: 34,
            column: 13
          },
          end: {
            line: 50,
            column: 5
          }
        },
        line: 34
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 15,
            column: 44
          },
          end: {
            line: 15,
            column: 83
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 15,
              column: 44
            },
            end: {
              line: 15,
              column: 60
            }
          },
          {
            start: {
              line: 15,
              column: 64
            },
            end: {
              line: 15,
              column: 83
            }
          }
        ],
        line: 15
      },
      '1': {
        loc: {
          start: {
            line: 30,
            column: 4
          },
          end: {
            line: 30,
            column: 30
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 30,
              column: 4
            },
            end: {
              line: 30,
              column: 11
            }
          },
          {
            start: {
              line: 30,
              column: 15
            },
            end: {
              line: 30,
              column: 30
            }
          }
        ],
        line: 30
      },
      '2': {
        loc: {
          start: {
            line: 38,
            column: 6
          },
          end: {
            line: 43,
            column: 7
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 38,
              column: 6
            },
            end: {
              line: 43,
              column: 7
            }
          },
          {
            start: {
              line: 38,
              column: 6
            },
            end: {
              line: 43,
              column: 7
            }
          }
        ],
        line: 38
      },
      '3': {
        loc: {
          start: {
            line: 38,
            column: 10
          },
          end: {
            line: 38,
            column: 103
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 38,
              column: 10
            },
            end: {
              line: 38,
              column: 16
            }
          },
          {
            start: {
              line: 38,
              column: 21
            },
            end: {
              line: 38,
              column: 28
            }
          },
          {
            start: {
              line: 38,
              column: 32
            },
            end: {
              line: 38,
              column: 43
            }
          },
          {
            start: {
              line: 38,
              column: 48
            },
            end: {
              line: 38,
              column: 55
            }
          },
          {
            start: {
              line: 38,
              column: 60
            },
            end: {
              line: 38,
              column: 79
            }
          },
          {
            start: {
              line: 38,
              column: 83
            },
            end: {
              line: 38,
              column: 102
            }
          }
        ],
        line: 38
      },
      '4': {
        loc: {
          start: {
            line: 45,
            column: 6
          },
          end: {
            line: 49,
            column: 7
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 45,
              column: 6
            },
            end: {
              line: 49,
              column: 7
            }
          },
          {
            start: {
              line: 45,
              column: 6
            },
            end: {
              line: 49,
              column: 7
            }
          }
        ],
        line: 45
      },
      '5': {
        loc: {
          start: {
            line: 45,
            column: 10
          },
          end: {
            line: 45,
            column: 54
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 45,
              column: 10
            },
            end: {
              line: 45,
              column: 38
            }
          },
          {
            start: {
              line: 45,
              column: 42
            },
            end: {
              line: 45,
              column: 54
            }
          }
        ],
        line: 45
      },
      '6': {
        loc: {
          start: {
            line: 56,
            column: 45
          },
          end: {
            line: 56,
            column: 78
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 56,
              column: 45
            },
            end: {
              line: 56,
              column: 54
            }
          },
          {
            start: {
              line: 56,
              column: 58
            },
            end: {
              line: 56,
              column: 78
            }
          }
        ],
        line: 56
      },
      '7': {
        loc: {
          start: {
            line: 57,
            column: 9
          },
          end: {
            line: 57,
            column: 72
          }
        },
        type: 'cond-expr',
        locations: [
          {
            start: {
              line: 57,
              column: 42
            },
            end: {
              line: 57,
              column: 61
            }
          },
          {
            start: {
              line: 57,
              column: 64
            },
            end: {
              line: 57,
              column: 72
            }
          }
        ],
        line: 57
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0, 0, 0, 0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184',
    hash: '1b8484c46f5c93a752821229ef0d5eb4f8532b32'
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return (coverage[path] = coverageData);
})();

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = void 0;

var _propTypes = _interopRequireDefault(require('prop-types'));

var _react = _interopRequireWildcard(require('react'));

var _Context = _interopRequireDefault(require('./Context'));

var _getTabIndex = _interopRequireDefault(require('./getTabIndex'));

var _inputtableKey = _interopRequireDefault(require('./inputtableKey'));

function _getRequireWildcardCache() {
  if (typeof WeakMap !== 'function') return null;
  var cache = new WeakMap();
  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };
  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }
  var cache = _getRequireWildcardCache();
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  if (obj != null) {
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for (var key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
        if (desc && (desc.get || desc.set)) {
          Object.defineProperty(newObj, key, desc);
        } else {
          newObj[key] = obj[key];
        }
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _extends() {
  _extends =
    Object.assign ||
    function(target) {
      for (var i = 1; i < arguments.length; i++) {
        var source = arguments[i];
        for (var key in source) {
          if (Object.prototype.hasOwnProperty.call(source, key)) {
            target[key] = source[key];
          }
        }
      }
      return target;
    };
  return _extends.apply(this, arguments);
}

function _objectWithoutProperties(source, excluded) {
  if (source == null) return {};
  var target = _objectWithoutPropertiesLoose(source, excluded);
  var key, i;
  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);
    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }
  return target;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;
  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }
  return target;
}

var DEFAULT_STYLE =
  (cov_1axss8t0b2.s[0]++,
  {
    outline: 0
  });
cov_1axss8t0b2.s[1]++;

var FocusBox = function FocusBox(_ref) {
  var children = _ref.children,
    disabled = _ref.disabled,
    sendFocusRefProp = _ref.sendFocusRef,
    otherProps = _objectWithoutProperties(_ref, ['children', 'disabled', 'sendFocusRef']);

  cov_1axss8t0b2.f[0]++;
  var sendFocusRefPersist = (cov_1axss8t0b2.s[2]++, (0, _react.useRef)(null));
  var patchedSendFocusRef =
    (cov_1axss8t0b2.s[3]++,
    (0, _react.useMemo)(
      function() {
        cov_1axss8t0b2.f[1]++;
        cov_1axss8t0b2.s[4]++;
        return (cov_1axss8t0b2.b[0][0]++, sendFocusRefProp) || (cov_1axss8t0b2.b[0][1]++, sendFocusRefPersist);
      },
      [sendFocusRefPersist, sendFocusRefProp]
    ));
  var context =
    (cov_1axss8t0b2.s[5]++,
    (0, _react.useMemo)(
      function() {
        cov_1axss8t0b2.f[2]++;
        cov_1axss8t0b2.s[6]++;
        return {
          sendFocusRef: patchedSendFocusRef
        };
      },
      [patchedSendFocusRef]
    ));
  var focus =
    (cov_1axss8t0b2.s[7]++,
    (0, _react.useCallback)(
      function() {
        cov_1axss8t0b2.f[3]++;

        var _ref2 = (cov_1axss8t0b2.s[8]++, patchedSendFocusRef),
          current = _ref2.current;

        cov_1axss8t0b2.s[9]++;
        (cov_1axss8t0b2.b[1][0]++, current) && (cov_1axss8t0b2.b[1][1]++, current.focus());
      },
      [patchedSendFocusRef]
    ));
  var handleKeyDownCapture =
    (cov_1axss8t0b2.s[10]++,
    (0, _react.useCallback)(
      function(event) {
        cov_1axss8t0b2.f[4]++;

        var _ref3 = (cov_1axss8t0b2.s[11]++, event),
          altKey = _ref3.altKey,
          ctrlKey = _ref3.ctrlKey,
          key = _ref3.key,
          metaKey = _ref3.metaKey,
          target = _ref3.target;

        var tabIndex = (cov_1axss8t0b2.s[12]++, (0, _getTabIndex.default)(target));
        cov_1axss8t0b2.s[13]++;

        if (
          (cov_1axss8t0b2.b[3][0]++, altKey) ||
          ((cov_1axss8t0b2.b[3][1]++, ctrlKey) && (cov_1axss8t0b2.b[3][2]++, key !== 'v')) ||
          (cov_1axss8t0b2.b[3][3]++, metaKey) ||
          ((cov_1axss8t0b2.b[3][4]++, !(0, _inputtableKey.default)(key)) &&
            (cov_1axss8t0b2.b[3][5]++, key !== 'Backspace'))
        ) {
          cov_1axss8t0b2.b[2][0]++;
          cov_1axss8t0b2.s[14]++;
          // Ignore if one of the utility key (except SHIFT) is pressed
          // E.g. CTRL-C on a link in one of the message should not jump to chat box
          // E.g. "A" or "Backspace" should jump to chat box
          return;
        } else {
          cov_1axss8t0b2.b[2][1]++;
        }

        cov_1axss8t0b2.s[15]++;

        if ((cov_1axss8t0b2.b[5][0]++, typeof tabIndex !== 'number') || (cov_1axss8t0b2.b[5][1]++, tabIndex < 0)) {
          cov_1axss8t0b2.b[4][0]++;
          cov_1axss8t0b2.s[16]++;
          event.stopPropagation();
          cov_1axss8t0b2.s[17]++;
          focus();
        } else {
          cov_1axss8t0b2.b[4][1]++;
        }
      },
      [focus]
    ));
  cov_1axss8t0b2.s[18]++;
  return _react.default.createElement(
    _Context.default.Provider,
    {
      value: context
    },
    _react.default.createElement(
      'div',
      _extends({}, otherProps, {
        onKeyDownCapture: (cov_1axss8t0b2.b[6][0]++, !disabled) && (cov_1axss8t0b2.b[6][1]++, handleKeyDownCapture),
        style: DEFAULT_STYLE,
        tabIndex: -1
      }),
      typeof children === 'function'
        ? (cov_1axss8t0b2.b[7][0]++,
          children({
            focus: focus
          }))
        : (cov_1axss8t0b2.b[7][1]++, children)
    )
  );
};

cov_1axss8t0b2.s[19]++;
FocusBox.defaultProps = {
  children: undefined,
  disabled: false
};
cov_1axss8t0b2.s[20]++;
FocusBox.propTypes = {
  children: _propTypes.default.any,
  disabled: _propTypes.default.bool,
  sendFocusRef: _propTypes.default.shape({
    current: _propTypes.default.shape({
      focus: _propTypes.default.func
    })
  }).isRequired
};
var _default = FocusBox;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9VdGlscy9UeXBlRm9jdXNTaW5rL0ZvY3VzQm94LmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfU1RZTEUiLCJvdXRsaW5lIiwiRm9jdXNCb3giLCJjaGlsZHJlbiIsImRpc2FibGVkIiwic2VuZEZvY3VzUmVmUHJvcCIsInNlbmRGb2N1c1JlZiIsIm90aGVyUHJvcHMiLCJzZW5kRm9jdXNSZWZQZXJzaXN0IiwicGF0Y2hlZFNlbmRGb2N1c1JlZiIsImNvbnRleHQiLCJmb2N1cyIsImN1cnJlbnQiLCJoYW5kbGVLZXlEb3duQ2FwdHVyZSIsImV2ZW50IiwiYWx0S2V5IiwiY3RybEtleSIsImtleSIsIm1ldGFLZXkiLCJ0YXJnZXQiLCJ0YWJJbmRleCIsInN0b3BQcm9wYWdhdGlvbiIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImFueSIsImJvb2wiLCJzaGFwZSIsImZ1bmMiLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QkFBZ0IsRUFBRSw0QkFBQ0gsUUFBRCxnQ0FBYVMsb0JBQWIsQ0FBdkM7QUFBMEUsSUFBQSxLQUFLLEVBQUViLGFBQWpGO0FBQWdHLElBQUEsUUFBUSxFQUFFLENBQUM7QUFBM0csTUFDRyxPQUFPRyxRQUFQLEtBQW9CLFVBQXBCLDhCQUFpQ0EsUUFBUSxDQUFDO0FBQUVRLElBQUFBLEtBQUssRUFBTEE7QUFBRixHQUFELENBQXpDLCtCQUF1RFIsUUFBdkQsQ0FESCxDQURGLENBREY7QUFPRCxDQWhERDs7O0FBa0RBRCxRQUFRLENBQUNvQixZQUFULEdBQXdCO0FBQ3RCbkIsRUFBQUEsUUFBUSxFQUFFb0IsU0FEWTtBQUV0Qm5CLEVBQUFBLFFBQVEsRUFBRTtBQUZZLENBQXhCOztBQUtBRixRQUFRLENBQUNzQixTQUFULEdBQXFCO0FBQ25CckIsRUFBQUEsUUFBUSxFQUFFc0IsbUJBQVVDLEdBREQ7QUFFbkJ0QixFQUFBQSxRQUFRLEVBQUVxQixtQkFBVUUsSUFGRDtBQUduQnJCLEVBQUFBLFlBQVksRUFBRW1CLG1CQUFVRyxLQUFWLENBQWdCO0FBQzVCaEIsSUFBQUEsT0FBTyxFQUFFYSxtQkFBVUcsS0FBVixDQUFnQjtBQUN2QmpCLE1BQUFBLEtBQUssRUFBRWMsbUJBQVVJO0FBRE0sS0FBaEI7QUFEbUIsR0FBaEIsRUFJWEM7QUFQZ0IsQ0FBckI7ZUFVZTVCLFEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIGlzIGZvciBkZWZhdWx0UHJvcHM6IHsgY2hpbGRyZW46IHVuZGVmaW5lZCB9XG4vKiBlc2xpbnQgbm8tdW5kZWZpbmVkOiBcIm9mZlwiICovXG5cbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZU1lbW8sIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IENvbnRleHQgZnJvbSAnLi9Db250ZXh0JztcbmltcG9ydCBnZXRUYWJJbmRleCBmcm9tICcuL2dldFRhYkluZGV4JztcbmltcG9ydCBpbnB1dHRhYmxlS2V5IGZyb20gJy4vaW5wdXR0YWJsZUtleSc7XG5cbmNvbnN0IERFRkFVTFRfU1RZTEUgPSB7IG91dGxpbmU6IDAgfTtcblxuY29uc3QgRm9jdXNCb3ggPSAoeyBjaGlsZHJlbiwgZGlzYWJsZWQsIHNlbmRGb2N1c1JlZjogc2VuZEZvY3VzUmVmUHJvcCwgLi4ub3RoZXJQcm9wcyB9KSA9PiB7XG4gIGNvbnN0IHNlbmRGb2N1c1JlZlBlcnNpc3QgPSB1c2VSZWYobnVsbCk7XG4gIGNvbnN0IHBhdGNoZWRTZW5kRm9jdXNSZWYgPSB1c2VNZW1vKCgpID0+IHNlbmRGb2N1c1JlZlByb3AgfHwgc2VuZEZvY3VzUmVmUGVyc2lzdCwgW1xuICAgIHNlbmRGb2N1c1JlZlBlcnNpc3QsXG4gICAgc2VuZEZvY3VzUmVmUHJvcFxuICBdKTtcblxuICBjb25zdCBjb250ZXh0ID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgc2VuZEZvY3VzUmVmOiBwYXRjaGVkU2VuZEZvY3VzUmVmXG4gICAgfSksXG4gICAgW3BhdGNoZWRTZW5kRm9jdXNSZWZdXG4gICk7XG5cbiAgY29uc3QgZm9jdXMgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgY29uc3QgeyBjdXJyZW50IH0gPSBwYXRjaGVkU2VuZEZvY3VzUmVmO1xuXG4gICAgY3VycmVudCAmJiBjdXJyZW50LmZvY3VzKCk7XG4gIH0sIFtwYXRjaGVkU2VuZEZvY3VzUmVmXSk7XG5cbiAgY29uc3QgaGFuZGxlS2V5RG93bkNhcHR1cmUgPSB1c2VDYWxsYmFjayhcbiAgICBldmVudCA9PiB7XG4gICAgICBjb25zdCB7IGFsdEtleSwgY3RybEtleSwga2V5LCBtZXRhS2V5LCB0YXJnZXQgfSA9IGV2ZW50O1xuICAgICAgY29uc3QgdGFiSW5kZXggPSBnZXRUYWJJbmRleCh0YXJnZXQpO1xuXG4gICAgICBpZiAoYWx0S2V5IHx8IChjdHJsS2V5ICYmIGtleSAhPT0gJ3YnKSB8fCBtZXRhS2V5IHx8ICghaW5wdXR0YWJsZUtleShrZXkpICYmIGtleSAhPT0gJ0JhY2tzcGFjZScpKSB7XG4gICAgICAgIC8vIElnbm9yZSBpZiBvbmUgb2YgdGhlIHV0aWxpdHkga2V5IChleGNlcHQgU0hJRlQpIGlzIHByZXNzZWRcbiAgICAgICAgLy8gRS5nLiBDVFJMLUMgb24gYSBsaW5rIGluIG9uZSBvZiB0aGUgbWVzc2FnZSBzaG91bGQgbm90IGp1bXAgdG8gY2hhdCBib3hcbiAgICAgICAgLy8gRS5nLiBcIkFcIiBvciBcIkJhY2tzcGFjZVwiIHNob3VsZCBqdW1wIHRvIGNoYXQgYm94XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiB0YWJJbmRleCAhPT0gJ251bWJlcicgfHwgdGFiSW5kZXggPCAwKSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGZvY3VzKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbZm9jdXNdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17Y29udGV4dH0+XG4gICAgICA8ZGl2IHsuLi5vdGhlclByb3BzfSBvbktleURvd25DYXB0dXJlPXshZGlzYWJsZWQgJiYgaGFuZGxlS2V5RG93bkNhcHR1cmV9IHN0eWxlPXtERUZBVUxUX1NUWUxFfSB0YWJJbmRleD17LTF9PlxuICAgICAgICB7dHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nID8gY2hpbGRyZW4oeyBmb2N1cyB9KSA6IGNoaWxkcmVufVxuICAgICAgPC9kaXY+XG4gICAgPC9Db250ZXh0LlByb3ZpZGVyPlxuICApO1xufTtcblxuRm9jdXNCb3guZGVmYXVsdFByb3BzID0ge1xuICBjaGlsZHJlbjogdW5kZWZpbmVkLFxuICBkaXNhYmxlZDogZmFsc2Vcbn07XG5cbkZvY3VzQm94LnByb3BUeXBlcyA9IHtcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2VuZEZvY3VzUmVmOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGN1cnJlbnQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBmb2N1czogUHJvcFR5cGVzLmZ1bmNcbiAgICB9KVxuICB9KS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBGb2N1c0JveDtcbiJdfQ==
