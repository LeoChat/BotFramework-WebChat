'use strict';

var cov_8jrh0dua2 = (function() {
  var path = '/Users/guy/Work/Leo/leo/BotFramework-WebChat/packages/core/src/sagas/postActivitySaga.js';
  var hash = '7eaa846b2e8a77be80eb8b5ee0bea8bc486c228c';
  var global = new Function('return this')();
  var gcv = '__coverage__';
  var coverageData = {
    path: '/Users/guy/Work/Leo/leo/BotFramework-WebChat/packages/core/src/sagas/postActivitySaga.js',
    statementMap: {
      '0': {
        start: {
          line: 25,
          column: 2
        },
        end: {
          line: 25,
          column: 66
        }
      },
      '1': {
        start: {
          line: 29,
          column: 42
        },
        end: {
          line: 31,
          column: 3
        }
      },
      '2': {
        start: {
          line: 32,
          column: 79
        },
        end: {
          line: 32,
          column: 87
        }
      },
      '3': {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 59,
          column: 4
        }
      },
      '4': {
        start: {
          line: 38,
          column: 62
        },
        end: {
          line: 42,
          column: 7
        }
      },
      '5': {
        start: {
          line: 61,
          column: 2
        },
        end: {
          line: 73,
          column: 3
        }
      },
      '6': {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 72,
          column: 6
        }
      },
      '7': {
        start: {
          line: 75,
          column: 15
        },
        end: {
          line: 75,
          column: 43
        }
      },
      '8': {
        start: {
          line: 77,
          column: 2
        },
        end: {
          line: 77,
          column: 74
        }
      },
      '9': {
        start: {
          line: 79,
          column: 2
        },
        end: {
          line: 120,
          column: 3
        }
      },
      '10': {
        start: {
          line: 83,
          column: 25
        },
        end: {
          line: 94,
          column: 6
        }
      },
      '11': {
        start: {
          line: 84,
          column: 6
        },
        end: {
          line: 93,
          column: 7
        }
      },
      '12': {
        start: {
          line: 87,
          column: 12
        },
        end: {
          line: 87,
          column: 41
        }
      },
      '13': {
        start: {
          line: 88,
          column: 41
        },
        end: {
          line: 88,
          column: 49
        }
      },
      '14': {
        start: {
          line: 90,
          column: 8
        },
        end: {
          line: 92,
          column: 9
        }
      },
      '15': {
        start: {
          line: 91,
          column: 10
        },
        end: {
          line: 91,
          column: 26
        }
      },
      '16': {
        start: {
          line: 101,
          column: 24
        },
        end: {
          line: 101,
          column: 57
        }
      },
      '17': {
        start: {
          line: 105,
          column: 8
        },
        end: {
          line: 111,
          column: 6
        }
      },
      '18': {
        start: {
          line: 110,
          column: 26
        },
        end: {
          line: 110,
          column: 93
        }
      },
      '19': {
        start: {
          line: 110,
          column: 56
        },
        end: {
          line: 110,
          column: 92
        }
      },
      '20': {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 113,
          column: 88
        }
      },
      '21': {
        start: {
          line: 115,
          column: 4
        },
        end: {
          line: 115,
          column: 81
        }
      },
      '22': {
        start: {
          line: 117,
          column: 4
        },
        end: {
          line: 119,
          column: 5
        }
      },
      '23': {
        start: {
          line: 118,
          column: 6
        },
        end: {
          line: 118,
          column: 102
        }
      },
      '24': {
        start: {
          line: 124,
          column: 2
        },
        end: {
          line: 130,
          column: 5
        }
      },
      '25': {
        start: {
          line: 125,
          column: 30
        },
        end: {
          line: 125,
          column: 31
        }
      },
      '26': {
        start: {
          line: 127,
          column: 4
        },
        end: {
          line: 129,
          column: 7
        }
      },
      '27': {
        start: {
          line: 128,
          column: 6
        },
        end: {
          line: 128,
          column: 87
        }
      }
    },
    fnMap: {
      '0': {
        name: 'getTimestamp',
        decl: {
          start: {
            line: 24,
            column: 9
          },
          end: {
            line: 24,
            column: 21
          }
        },
        loc: {
          start: {
            line: 24,
            column: 47
          },
          end: {
            line: 26,
            column: 1
          }
        },
        line: 24
      },
      '1': {
        name: 'postActivity',
        decl: {
          start: {
            line: 28,
            column: 10
          },
          end: {
            line: 28,
            column: 22
          }
        },
        loc: {
          start: {
            line: 28,
            column: 119
          },
          end: {
            line: 121,
            column: 1
          }
        },
        line: 28
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 38,
            column: 22
          },
          end: {
            line: 38,
            column: 23
          }
        },
        loc: {
          start: {
            line: 38,
            column: 62
          },
          end: {
            line: 42,
            column: 7
          }
        },
        line: 38
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 83,
            column: 30
          },
          end: {
            line: 83,
            column: 31
          }
        },
        loc: {
          start: {
            line: 83,
            column: 42
          },
          end: {
            line: 94,
            column: 5
          }
        },
        line: 83
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 110,
            column: 20
          },
          end: {
            line: 110,
            column: 21
          }
        },
        loc: {
          start: {
            line: 110,
            column: 26
          },
          end: {
            line: 110,
            column: 93
          }
        },
        line: 110
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 110,
            column: 50
          },
          end: {
            line: 110,
            column: 51
          }
        },
        loc: {
          start: {
            line: 110,
            column: 56
          },
          end: {
            line: 110,
            column: 92
          }
        },
        line: 110
      },
      '6': {
        name: 'postActivitySaga',
        decl: {
          start: {
            line: 123,
            column: 25
          },
          end: {
            line: 123,
            column: 41
          }
        },
        loc: {
          start: {
            line: 123,
            column: 44
          },
          end: {
            line: 131,
            column: 1
          }
        },
        line: 123
      },
      '7': {
        name: 'postActivityWhileConnected',
        decl: {
          start: {
            line: 124,
            column: 33
          },
          end: {
            line: 124,
            column: 59
          }
        },
        loc: {
          start: {
            line: 124,
            column: 94
          },
          end: {
            line: 130,
            column: 3
          }
        },
        line: 124
      },
      '8': {
        name: 'postActivityWrapper',
        decl: {
          start: {
            line: 127,
            column: 45
          },
          end: {
            line: 127,
            column: 64
          }
        },
        loc: {
          start: {
            line: 127,
            column: 73
          },
          end: {
            line: 129,
            column: 5
          }
        },
        line: 127
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 24,
            column: 22
          },
          end: {
            line: 24,
            column: 45
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 24,
              column: 44
            },
            end: {
              line: 24,
              column: 45
            }
          }
        ],
        line: 24
      },
      '1': {
        loc: {
          start: {
            line: 32,
            column: 36
          },
          end: {
            line: 32,
            column: 74
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 32,
              column: 72
            },
            end: {
              line: 32,
              column: 74
            }
          }
        ],
        line: 32
      },
      '2': {
        loc: {
          start: {
            line: 32,
            column: 38
          },
          end: {
            line: 32,
            column: 67
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 32,
              column: 57
            },
            end: {
              line: 32,
              column: 67
            }
          }
        ],
        line: 32
      },
      '3': {
        loc: {
          start: {
            line: 37,
            column: 6
          },
          end: {
            line: 42,
            column: 9
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 37,
              column: 6
            },
            end: {
              line: 37,
              column: 17
            }
          },
          {
            start: {
              line: 38,
              column: 6
            },
            end: {
              line: 42,
              column: 9
            }
          }
        ],
        line: 37
      },
      '4': {
        loc: {
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 73,
            column: 3
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 61,
              column: 2
            },
            end: {
              line: 73,
              column: 3
            }
          },
          {
            start: {
              line: 61,
              column: 2
            },
            end: {
              line: 73,
              column: 3
            }
          }
        ],
        line: 61
      },
      '5': {
        loc: {
          start: {
            line: 63,
            column: 10
          },
          end: {
            line: 63,
            column: 33
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 63,
              column: 10
            },
            end: {
              line: 63,
              column: 27
            }
          },
          {
            start: {
              line: 63,
              column: 31
            },
            end: {
              line: 63,
              column: 33
            }
          }
        ],
        line: 63
      },
      '6': {
        loc: {
          start: {
            line: 88,
            column: 16
          },
          end: {
            line: 88,
            column: 32
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 88,
              column: 30
            },
            end: {
              line: 88,
              column: 32
            }
          }
        ],
        line: 88
      },
      '7': {
        loc: {
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 92,
            column: 9
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 90,
              column: 8
            },
            end: {
              line: 92,
              column: 9
            }
          },
          {
            start: {
              line: 90,
              column: 8
            },
            end: {
              line: 92,
              column: 9
            }
          }
        ],
        line: 90
      },
      '8': {
        loc: {
          start: {
            line: 90,
            column: 12
          },
          end: {
            line: 90,
            column: 67
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 90,
              column: 12
            },
            end: {
              line: 90,
              column: 61
            }
          },
          {
            start: {
              line: 90,
              column: 65
            },
            end: {
              line: 90,
              column: 67
            }
          }
        ],
        line: 90
      },
      '9': {
        loc: {
          start: {
            line: 117,
            column: 4
          },
          end: {
            line: 119,
            column: 5
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 117,
              column: 4
            },
            end: {
              line: 119,
              column: 5
            }
          },
          {
            start: {
              line: 117,
              column: 4
            },
            end: {
              line: 119,
              column: 5
            }
          }
        ],
        line: 117
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0
    },
    b: {
      '0': [0],
      '1': [0],
      '2': [0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184',
    hash: '7eaa846b2e8a77be80eb8b5ee0bea8bc486c228c'
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return (coverage[path] = coverageData);
})();

var _interopRequireDefault = require('@babel/runtime/helpers/interopRequireDefault');

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = postActivitySaga;

var _regenerator = _interopRequireDefault(require('@babel/runtime/regenerator'));

var _toConsumableArray2 = _interopRequireDefault(require('@babel/runtime/helpers/toConsumableArray'));

var _defineProperty2 = _interopRequireDefault(require('@babel/runtime/helpers/defineProperty'));

var _effects = require('redux-saga/effects');

var _observeOnce = _interopRequireDefault(require('./effects/observeOnce'));

var _whileConnected = _interopRequireDefault(require('./effects/whileConnected'));

var _clockSkewAdjustment = _interopRequireDefault(require('../selectors/clockSkewAdjustment'));

var _combineSelectors = _interopRequireDefault(require('../selectors/combineSelectors'));

var _language = _interopRequireDefault(require('../selectors/language'));

var _sendTimeout = _interopRequireDefault(require('../selectors/sendTimeout'));

var _deleteKey = _interopRequireDefault(require('../utils/deleteKey'));

var _sleep = _interopRequireDefault(require('../utils/sleep'));

var _uniqueID = _interopRequireDefault(require('../utils/uniqueID'));

var _postActivity = require('../actions/postActivity');

var _incomingActivity = require('../actions/incomingActivity');

var _marked =
    /*#__PURE__*/
    _regenerator['default'].mark(postActivity),
  _marked2 =
    /*#__PURE__*/
    _regenerator['default'].mark(postActivitySaga);

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);
  if (Object.getOwnPropertySymbols) {
    keys.push.apply(keys, Object.getOwnPropertySymbols(object));
  }
  if (enumerableOnly)
    keys = keys.filter(function(sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    if (i % 2) {
      ownKeys(source, true).forEach(function(key) {
        (0, _defineProperty2['default'])(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(source).forEach(function(key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }
  return target;
}

function getTimestamp() {
  var clockSkewAdjustment =
    arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (cov_8jrh0dua2.b[0][0]++, 0);
  cov_8jrh0dua2.f[0]++;
  cov_8jrh0dua2.s[0]++;
  return new Date(Date.now() + clockSkewAdjustment).toISOString();
}

function postActivity(directLine, userID, username, numActivitiesPosted, _ref) {
  var method,
    activity,
    _ref2,
    clockSkewAdjustment,
    locale,
    _ref3,
    attachments,
    _ref3$channelData,
    _ref3$channelData$cli,
    clientActivityID,
    meta,
    echoBackCall,
    sendTimeout,
    _ref7,
    echoBack;

  return _regenerator['default'].wrap(
    function postActivity$(_context2) {
      while (1) {
        switch ((_context2.prev = _context2.next)) {
          case 0:
            (method = _ref.meta.method), (activity = _ref.payload.activity);
            cov_8jrh0dua2.f[1]++;
            cov_8jrh0dua2.s[1]++;
            _context2.next = 5;
            return (0, _effects.select)(
              (0, _combineSelectors['default'])({
                clockSkewAdjustment: _clockSkewAdjustment['default'],
                locale: _language['default']
              })
            );

          case 5:
            _ref2 = _context2.sent;
            clockSkewAdjustment = _ref2.clockSkewAdjustment;
            locale = _ref2.locale;
            (_ref3 = (cov_8jrh0dua2.s[2]++, activity)),
              (attachments = _ref3.attachments),
              (_ref3$channelData = _ref3.channelData);
            _ref3$channelData = _ref3$channelData === void 0 ? (cov_8jrh0dua2.b[1][0]++, {}) : _ref3$channelData;
            (_ref3$channelData$cli = _ref3$channelData.clientActivityID),
              (clientActivityID =
                _ref3$channelData$cli === void 0
                  ? (cov_8jrh0dua2.b[2][0]++, (0, _uniqueID['default'])())
                  : _ref3$channelData$cli);
            cov_8jrh0dua2.s[3]++;
            activity = _objectSpread({}, (0, _deleteKey['default'])(activity, 'id'), {
              attachments:
                (cov_8jrh0dua2.b[3][0]++, attachments) &&
                (cov_8jrh0dua2.b[3][1]++,
                attachments.map(function(_ref4) {
                  var contentType = _ref4.contentType,
                    contentUrl = _ref4.contentUrl,
                    name = _ref4.name;
                  cov_8jrh0dua2.f[2]++;
                  cov_8jrh0dua2.s[4]++;
                  return {
                    contentType: contentType,
                    contentUrl: contentUrl,
                    name: name
                  };
                })),
              channelData: _objectSpread(
                {
                  clientActivityID: clientActivityID,
                  // This is unskewed local timestamp for estimating clock skew.
                  clientTimestamp: getTimestamp()
                },
                (0, _deleteKey['default'])(activity.channelData, 'state')
              ),
              channelId: 'webchat',
              from: {
                id: userID,
                name: username,
                role: 'user'
              },
              locale: locale,
              // This timestamp will be replaced by Direct Line Channel in echoback.
              // We are temporarily adding this timestamp for sorting.
              timestamp: getTimestamp(clockSkewAdjustment)
            });
            cov_8jrh0dua2.s[5]++;

            if (!numActivitiesPosted) {
              cov_8jrh0dua2.b[4][0]++;
              cov_8jrh0dua2.s[6]++;
              activity.entities = [].concat(
                (0, _toConsumableArray2['default'])(
                  (cov_8jrh0dua2.b[5][0]++, activity.entities) || (cov_8jrh0dua2.b[5][1]++, [])
                ),
                [
                  {
                    // TODO: [P4] Currently in v3, we send the capabilities although the client might not actually have them
                    //       We need to understand why we need to send these, and only send capabilities the client have
                    requiresBotState: true,
                    supportsListening: true,
                    supportsTts: true,
                    type: 'ClientCapabilities'
                  }
                ]
              );
            } else {
              cov_8jrh0dua2.b[4][1]++;
            }

            meta =
              (cov_8jrh0dua2.s[7]++,
              {
                clientActivityID: clientActivityID,
                method: method
              });
            cov_8jrh0dua2.s[8]++;
            _context2.next = 19;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_PENDING,
              meta: meta,
              payload: {
                activity: activity
              }
            });

          case 19:
            cov_8jrh0dua2.s[9]++;
            _context2.prev = 20;
            // Quirks: We might receive INCOMING_ACTIVITY before the postActivity call completed
            //         So, we setup expectation first, then postActivity afterward
            echoBackCall =
              (cov_8jrh0dua2.s[10]++,
              (0, _effects.call)(
                /*#__PURE__*/
                _regenerator['default'].mark(function _callee() {
                  var _ref5, _activity, _ref6, _ref6$channelData, channelData, id;

                  return _regenerator['default'].wrap(function _callee$(_context) {
                    while (1) {
                      switch ((_context.prev = _context.next)) {
                        case 0:
                          cov_8jrh0dua2.f[3]++;
                          cov_8jrh0dua2.s[11]++;

                        case 2:
                          cov_8jrh0dua2.s[12]++;
                          _context.next = 5;
                          return (0, _effects.take)(_incomingActivity.INCOMING_ACTIVITY);

                        case 5:
                          _ref5 = _context.sent;
                          _activity = _ref5.payload.activity;
                          (_ref6 = (cov_8jrh0dua2.s[13]++, _activity)),
                            (_ref6$channelData = _ref6.channelData),
                            (channelData =
                              _ref6$channelData === void 0 ? (cov_8jrh0dua2.b[6][0]++, {}) : _ref6$channelData),
                            (id = _ref6.id);
                          cov_8jrh0dua2.s[14]++;

                          if (
                            !(
                              (cov_8jrh0dua2.b[8][0]++, channelData.clientActivityID === clientActivityID) &&
                              (cov_8jrh0dua2.b[8][1]++, id)
                            )
                          ) {
                            _context.next = 15;
                            break;
                          }

                          cov_8jrh0dua2.b[7][0]++;
                          cov_8jrh0dua2.s[15]++;
                          return _context.abrupt('return', _activity);

                        case 15:
                          cov_8jrh0dua2.b[7][1]++;

                        case 16:
                          _context.next = 2;
                          break;

                        case 18:
                        case 'end':
                          return _context.stop();
                      }
                    }
                  }, _callee);
                })
              )); // Timeout could be due to either:
            // - Post activity call may take too long time to complete
            //   - Direct Line service only respond on HTTP after bot respond to Direct Line
            // - Activity may take too long time to echo back

            cov_8jrh0dua2.s[16]++;
            _context2.next = 25;
            return (0, _effects.select)(_sendTimeout['default']);

          case 25:
            sendTimeout = _context2.sent;
            cov_8jrh0dua2.s[17]++;
            _context2.next = 29;
            return (0, _effects.race)({
              send: (0, _effects.all)({
                echoBack: echoBackCall,
                postActivity: (0, _observeOnce['default'])(directLine.postActivity(activity))
              }),
              timeout: (0, _effects.call)(function() {
                cov_8jrh0dua2.f[4]++;
                cov_8jrh0dua2.s[18]++;
                return (0, _sleep['default'])(sendTimeout).then(function() {
                  cov_8jrh0dua2.f[5]++;
                  cov_8jrh0dua2.s[19]++;
                  return Promise.reject(new Error('timeout'));
                });
              })
            });

          case 29:
            _ref7 = _context2.sent;
            echoBack = _ref7.send.echoBack;
            cov_8jrh0dua2.s[20]++;
            _context2.next = 34;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_FULFILLED,
              meta: meta,
              payload: {
                activity: echoBack
              }
            });

          case 34:
            _context2.next = 41;
            break;

          case 36:
            _context2.prev = 36;
            _context2.t0 = _context2['catch'](20);
            cov_8jrh0dua2.s[21]++;
            _context2.next = 41;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_REJECTED,
              error: true,
              meta: meta,
              payload: _context2.t0
            });

          case 41:
            _context2.prev = 41;
            cov_8jrh0dua2.s[22]++;
            _context2.next = 45;
            return (0, _effects.cancelled)();

          case 45:
            if (!_context2.sent) {
              _context2.next = 52;
              break;
            }

            cov_8jrh0dua2.b[9][0]++;
            cov_8jrh0dua2.s[23]++;
            _context2.next = 50;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_REJECTED,
              error: true,
              meta: meta,
              payload: new Error('cancelled')
            });

          case 50:
            _context2.next = 53;
            break;

          case 52:
            cov_8jrh0dua2.b[9][1]++;

          case 53:
            return _context2.finish(41);

          case 54:
          case 'end':
            return _context2.stop();
        }
      }
    },
    _marked,
    null,
    [[20, 36, 41, 54]]
  );
}

function postActivitySaga() {
  return _regenerator['default'].wrap(function postActivitySaga$(_context5) {
    while (1) {
      switch ((_context5.prev = _context5.next)) {
        case 0:
          cov_8jrh0dua2.f[6]++;
          cov_8jrh0dua2.s[24]++;
          _context5.next = 4;
          return (0, _whileConnected['default'])(
            /*#__PURE__*/
            _regenerator['default'].mark(function postActivityWhileConnected(_ref8) {
              var directLine, userID, username, numActivitiesPosted;
              return _regenerator['default'].wrap(function postActivityWhileConnected$(_context4) {
                while (1) {
                  switch ((_context4.prev = _context4.next)) {
                    case 0:
                      (directLine = _ref8.directLine), (userID = _ref8.userID), (username = _ref8.username);
                      cov_8jrh0dua2.f[7]++;
                      numActivitiesPosted = (cov_8jrh0dua2.s[25]++, 0);
                      cov_8jrh0dua2.s[26]++;
                      _context4.next = 6;
                      return (0, _effects.takeEvery)(
                        _postActivity.POST_ACTIVITY,
                        /*#__PURE__*/
                        _regenerator['default'].mark(function postActivityWrapper(action) {
                          return _regenerator['default'].wrap(function postActivityWrapper$(_context3) {
                            while (1) {
                              switch ((_context3.prev = _context3.next)) {
                                case 0:
                                  cov_8jrh0dua2.f[8]++;
                                  cov_8jrh0dua2.s[27]++;
                                  return _context3.delegateYield(
                                    postActivity(directLine, userID, username, numActivitiesPosted++, action),
                                    't0',
                                    3
                                  );

                                case 3:
                                case 'end':
                                  return _context3.stop();
                              }
                            }
                          }, postActivityWrapper);
                        })
                      );

                    case 6:
                    case 'end':
                      return _context4.stop();
                  }
                }
              }, postActivityWhileConnected);
            })
          );

        case 4:
        case 'end':
          return _context5.stop();
      }
    }
  }, _marked2);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zYWdhcy9wb3N0QWN0aXZpdHlTYWdhLmpzIl0sIm5hbWVzIjpbInBvc3RBY3Rpdml0eSIsInBvc3RBY3Rpdml0eVNhZ2EiLCJnZXRUaW1lc3RhbXAiLCJjbG9ja1NrZXdBZGp1c3RtZW50IiwiRGF0ZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiZGlyZWN0TGluZSIsInVzZXJJRCIsInVzZXJuYW1lIiwibnVtQWN0aXZpdGllc1Bvc3RlZCIsIm1ldGhvZCIsIm1ldGEiLCJhY3Rpdml0eSIsInBheWxvYWQiLCJjbG9ja1NrZXdBZGp1c3RtZW50U2VsZWN0b3IiLCJsb2NhbGUiLCJsYW5ndWFnZVNlbGVjdG9yIiwiYXR0YWNobWVudHMiLCJjaGFubmVsRGF0YSIsImNsaWVudEFjdGl2aXR5SUQiLCJtYXAiLCJjb250ZW50VHlwZSIsImNvbnRlbnRVcmwiLCJuYW1lIiwiY2xpZW50VGltZXN0YW1wIiwiY2hhbm5lbElkIiwiZnJvbSIsImlkIiwicm9sZSIsInRpbWVzdGFtcCIsImVudGl0aWVzIiwicmVxdWlyZXNCb3RTdGF0ZSIsInN1cHBvcnRzTGlzdGVuaW5nIiwic3VwcG9ydHNUdHMiLCJ0eXBlIiwiUE9TVF9BQ1RJVklUWV9QRU5ESU5HIiwiZWNob0JhY2tDYWxsIiwiSU5DT01JTkdfQUNUSVZJVFkiLCJzZW5kVGltZW91dFNlbGVjdG9yIiwic2VuZFRpbWVvdXQiLCJzZW5kIiwiZWNob0JhY2siLCJ0aW1lb3V0IiwidGhlbiIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciIsIlBPU1RfQUNUSVZJVFlfRlVMRklMTEVEIiwiUE9TVF9BQ1RJVklUWV9SRUpFQ1RFRCIsImVycm9yIiwicG9zdEFjdGl2aXR5V2hpbGVDb25uZWN0ZWQiLCJQT1NUX0FDVElWSVRZIiwicG9zdEFjdGl2aXR5V3JhcHBlciIsImFjdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUVBOztBQU9BOzs7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QUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNiLGlCQUFNO0FBQUE7QUFBQSx1Q0FBZSxTQUFVa0QsMEJBQVY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQXVDNUMsb0JBQUFBLFVBQXZDLFNBQXVDQSxVQUF2QyxFQUFtREMsTUFBbkQsU0FBbURBLE1BQW5ELEVBQTJEQyxRQUEzRCxTQUEyREEsUUFBM0Q7QUFBQTtBQUNmQyxvQkFBQUEsbUJBRGUsMkJBQ08sQ0FEUDtBQUFBO0FBQUE7QUFHbkIsMkJBQU0sd0JBQVUwQywyQkFBVjtBQUFBO0FBQUEsaURBQXlCLFNBQVVDLG1CQUFWLENBQThCQyxNQUE5QjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUM3Qiw2REFBT3RELFlBQVksQ0FBQ08sVUFBRCxFQUFhQyxNQUFiLEVBQXFCQyxRQUFyQixFQUErQkMsbUJBQW1CLEVBQWxELEVBQXNENEMsTUFBdEQsQ0FBbkI7O0FBRDZCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx5QkFBVUQsbUJBQVY7QUFBQSxxQkFBekIsRUFBTjs7QUFIbUI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGVBQVVGLDBCQUFWO0FBQUEsV0FBZixFQUFOOztBQURhO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYWxsLCBjYWxsLCBjYW5jZWxsZWQsIHB1dCwgcmFjZSwgc2VsZWN0LCB0YWtlLCB0YWtlRXZlcnkgfSBmcm9tICdyZWR1eC1zYWdhL2VmZmVjdHMnO1xuXG5pbXBvcnQgb2JzZXJ2ZU9uY2UgZnJvbSAnLi9lZmZlY3RzL29ic2VydmVPbmNlJztcbmltcG9ydCB3aGlsZUNvbm5lY3RlZCBmcm9tICcuL2VmZmVjdHMvd2hpbGVDb25uZWN0ZWQnO1xuXG5pbXBvcnQgY2xvY2tTa2V3QWRqdXN0bWVudFNlbGVjdG9yIGZyb20gJy4uL3NlbGVjdG9ycy9jbG9ja1NrZXdBZGp1c3RtZW50JztcbmltcG9ydCBjb21iaW5lU2VsZWN0b3JzIGZyb20gJy4uL3NlbGVjdG9ycy9jb21iaW5lU2VsZWN0b3JzJztcbmltcG9ydCBsYW5ndWFnZVNlbGVjdG9yIGZyb20gJy4uL3NlbGVjdG9ycy9sYW5ndWFnZSc7XG5pbXBvcnQgc2VuZFRpbWVvdXRTZWxlY3RvciBmcm9tICcuLi9zZWxlY3RvcnMvc2VuZFRpbWVvdXQnO1xuXG5pbXBvcnQgZGVsZXRlS2V5IGZyb20gJy4uL3V0aWxzL2RlbGV0ZUtleSc7XG5pbXBvcnQgc2xlZXAgZnJvbSAnLi4vdXRpbHMvc2xlZXAnO1xuaW1wb3J0IHVuaXF1ZUlEIGZyb20gJy4uL3V0aWxzL3VuaXF1ZUlEJztcblxuaW1wb3J0IHtcbiAgUE9TVF9BQ1RJVklUWSxcbiAgUE9TVF9BQ1RJVklUWV9GVUxGSUxMRUQsXG4gIFBPU1RfQUNUSVZJVFlfUEVORElORyxcbiAgUE9TVF9BQ1RJVklUWV9SRUpFQ1RFRFxufSBmcm9tICcuLi9hY3Rpb25zL3Bvc3RBY3Rpdml0eSc7XG5cbmltcG9ydCB7IElOQ09NSU5HX0FDVElWSVRZIH0gZnJvbSAnLi4vYWN0aW9ucy9pbmNvbWluZ0FjdGl2aXR5JztcblxuZnVuY3Rpb24gZ2V0VGltZXN0YW1wKGNsb2NrU2tld0FkanVzdG1lbnQgPSAwKSB7XG4gIHJldHVybiBuZXcgRGF0ZShEYXRlLm5vdygpICsgY2xvY2tTa2V3QWRqdXN0bWVudCkudG9JU09TdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24qIHBvc3RBY3Rpdml0eShkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lLCBudW1BY3Rpdml0aWVzUG9zdGVkLCB7IG1ldGE6IHsgbWV0aG9kIH0sIHBheWxvYWQ6IHsgYWN0aXZpdHkgfSB9KSB7XG4gIGNvbnN0IHsgY2xvY2tTa2V3QWRqdXN0bWVudCwgbG9jYWxlIH0gPSB5aWVsZCBzZWxlY3QoXG4gICAgY29tYmluZVNlbGVjdG9ycyh7IGNsb2NrU2tld0FkanVzdG1lbnQ6IGNsb2NrU2tld0FkanVzdG1lbnRTZWxlY3RvciwgbG9jYWxlOiBsYW5ndWFnZVNlbGVjdG9yIH0pXG4gICk7XG4gIGNvbnN0IHsgYXR0YWNobWVudHMsIGNoYW5uZWxEYXRhOiB7IGNsaWVudEFjdGl2aXR5SUQgPSB1bmlxdWVJRCgpIH0gPSB7fSB9ID0gYWN0aXZpdHk7XG5cbiAgYWN0aXZpdHkgPSB7XG4gICAgLi4uZGVsZXRlS2V5KGFjdGl2aXR5LCAnaWQnKSxcbiAgICBhdHRhY2htZW50czpcbiAgICAgIGF0dGFjaG1lbnRzICYmXG4gICAgICBhdHRhY2htZW50cy5tYXAoKHsgY29udGVudFR5cGUsIGNvbnRlbnRVcmwsIG5hbWUgfSkgPT4gKHtcbiAgICAgICAgY29udGVudFR5cGUsXG4gICAgICAgIGNvbnRlbnRVcmwsXG4gICAgICAgIG5hbWVcbiAgICAgIH0pKSxcbiAgICBjaGFubmVsRGF0YToge1xuICAgICAgY2xpZW50QWN0aXZpdHlJRCxcbiAgICAgIC8vIFRoaXMgaXMgdW5za2V3ZWQgbG9jYWwgdGltZXN0YW1wIGZvciBlc3RpbWF0aW5nIGNsb2NrIHNrZXcuXG4gICAgICBjbGllbnRUaW1lc3RhbXA6IGdldFRpbWVzdGFtcCgpLFxuICAgICAgLi4uZGVsZXRlS2V5KGFjdGl2aXR5LmNoYW5uZWxEYXRhLCAnc3RhdGUnKVxuICAgIH0sXG4gICAgY2hhbm5lbElkOiAnd2ViY2hhdCcsXG4gICAgZnJvbToge1xuICAgICAgaWQ6IHVzZXJJRCxcbiAgICAgIG5hbWU6IHVzZXJuYW1lLFxuICAgICAgcm9sZTogJ3VzZXInXG4gICAgfSxcbiAgICBsb2NhbGUsXG4gICAgLy8gVGhpcyB0aW1lc3RhbXAgd2lsbCBiZSByZXBsYWNlZCBieSBEaXJlY3QgTGluZSBDaGFubmVsIGluIGVjaG9iYWNrLlxuICAgIC8vIFdlIGFyZSB0ZW1wb3JhcmlseSBhZGRpbmcgdGhpcyB0aW1lc3RhbXAgZm9yIHNvcnRpbmcuXG4gICAgdGltZXN0YW1wOiBnZXRUaW1lc3RhbXAoY2xvY2tTa2V3QWRqdXN0bWVudClcbiAgfTtcblxuICBpZiAoIW51bUFjdGl2aXRpZXNQb3N0ZWQpIHtcbiAgICBhY3Rpdml0eS5lbnRpdGllcyA9IFtcbiAgICAgIC4uLihhY3Rpdml0eS5lbnRpdGllcyB8fCBbXSksXG4gICAgICB7XG4gICAgICAgIC8vIFRPRE86IFtQNF0gQ3VycmVudGx5IGluIHYzLCB3ZSBzZW5kIHRoZSBjYXBhYmlsaXRpZXMgYWx0aG91Z2ggdGhlIGNsaWVudCBtaWdodCBub3QgYWN0dWFsbHkgaGF2ZSB0aGVtXG4gICAgICAgIC8vICAgICAgIFdlIG5lZWQgdG8gdW5kZXJzdGFuZCB3aHkgd2UgbmVlZCB0byBzZW5kIHRoZXNlLCBhbmQgb25seSBzZW5kIGNhcGFiaWxpdGllcyB0aGUgY2xpZW50IGhhdmVcbiAgICAgICAgcmVxdWlyZXNCb3RTdGF0ZTogdHJ1ZSxcbiAgICAgICAgc3VwcG9ydHNMaXN0ZW5pbmc6IHRydWUsXG4gICAgICAgIHN1cHBvcnRzVHRzOiB0cnVlLFxuICAgICAgICB0eXBlOiAnQ2xpZW50Q2FwYWJpbGl0aWVzJ1xuICAgICAgfVxuICAgIF07XG4gIH1cblxuICBjb25zdCBtZXRhID0geyBjbGllbnRBY3Rpdml0eUlELCBtZXRob2QgfTtcblxuICB5aWVsZCBwdXQoeyB0eXBlOiBQT1NUX0FDVElWSVRZX1BFTkRJTkcsIG1ldGEsIHBheWxvYWQ6IHsgYWN0aXZpdHkgfSB9KTtcblxuICB0cnkge1xuICAgIC8vIFF1aXJrczogV2UgbWlnaHQgcmVjZWl2ZSBJTkNPTUlOR19BQ1RJVklUWSBiZWZvcmUgdGhlIHBvc3RBY3Rpdml0eSBjYWxsIGNvbXBsZXRlZFxuICAgIC8vICAgICAgICAgU28sIHdlIHNldHVwIGV4cGVjdGF0aW9uIGZpcnN0LCB0aGVuIHBvc3RBY3Rpdml0eSBhZnRlcndhcmRcblxuICAgIGNvbnN0IGVjaG9CYWNrQ2FsbCA9IGNhbGwoZnVuY3Rpb24qKCkge1xuICAgICAgZm9yICg7Oykge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGF5bG9hZDogeyBhY3Rpdml0eSB9XG4gICAgICAgIH0gPSB5aWVsZCB0YWtlKElOQ09NSU5HX0FDVElWSVRZKTtcbiAgICAgICAgY29uc3QgeyBjaGFubmVsRGF0YSA9IHt9LCBpZCB9ID0gYWN0aXZpdHk7XG5cbiAgICAgICAgaWYgKGNoYW5uZWxEYXRhLmNsaWVudEFjdGl2aXR5SUQgPT09IGNsaWVudEFjdGl2aXR5SUQgJiYgaWQpIHtcbiAgICAgICAgICByZXR1cm4gYWN0aXZpdHk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFRpbWVvdXQgY291bGQgYmUgZHVlIHRvIGVpdGhlcjpcbiAgICAvLyAtIFBvc3QgYWN0aXZpdHkgY2FsbCBtYXkgdGFrZSB0b28gbG9uZyB0aW1lIHRvIGNvbXBsZXRlXG4gICAgLy8gICAtIERpcmVjdCBMaW5lIHNlcnZpY2Ugb25seSByZXNwb25kIG9uIEhUVFAgYWZ0ZXIgYm90IHJlc3BvbmQgdG8gRGlyZWN0IExpbmVcbiAgICAvLyAtIEFjdGl2aXR5IG1heSB0YWtlIHRvbyBsb25nIHRpbWUgdG8gZWNobyBiYWNrXG5cbiAgICBjb25zdCBzZW5kVGltZW91dCA9IHlpZWxkIHNlbGVjdChzZW5kVGltZW91dFNlbGVjdG9yKTtcblxuICAgIGNvbnN0IHtcbiAgICAgIHNlbmQ6IHsgZWNob0JhY2sgfVxuICAgIH0gPSB5aWVsZCByYWNlKHtcbiAgICAgIHNlbmQ6IGFsbCh7XG4gICAgICAgIGVjaG9CYWNrOiBlY2hvQmFja0NhbGwsXG4gICAgICAgIHBvc3RBY3Rpdml0eTogb2JzZXJ2ZU9uY2UoZGlyZWN0TGluZS5wb3N0QWN0aXZpdHkoYWN0aXZpdHkpKVxuICAgICAgfSksXG4gICAgICB0aW1lb3V0OiBjYWxsKCgpID0+IHNsZWVwKHNlbmRUaW1lb3V0KS50aGVuKCgpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigndGltZW91dCcpKSkpXG4gICAgfSk7XG5cbiAgICB5aWVsZCBwdXQoeyB0eXBlOiBQT1NUX0FDVElWSVRZX0ZVTEZJTExFRCwgbWV0YSwgcGF5bG9hZDogeyBhY3Rpdml0eTogZWNob0JhY2sgfSB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgeWllbGQgcHV0KHsgdHlwZTogUE9TVF9BQ1RJVklUWV9SRUpFQ1RFRCwgZXJyb3I6IHRydWUsIG1ldGEsIHBheWxvYWQ6IGVyciB9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoeWllbGQgY2FuY2VsbGVkKCkpIHtcbiAgICAgIHlpZWxkIHB1dCh7IHR5cGU6IFBPU1RfQUNUSVZJVFlfUkVKRUNURUQsIGVycm9yOiB0cnVlLCBtZXRhLCBwYXlsb2FkOiBuZXcgRXJyb3IoJ2NhbmNlbGxlZCcpIH0pO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiogcG9zdEFjdGl2aXR5U2FnYSgpIHtcbiAgeWllbGQgd2hpbGVDb25uZWN0ZWQoZnVuY3Rpb24qIHBvc3RBY3Rpdml0eVdoaWxlQ29ubmVjdGVkKHsgZGlyZWN0TGluZSwgdXNlcklELCB1c2VybmFtZSB9KSB7XG4gICAgbGV0IG51bUFjdGl2aXRpZXNQb3N0ZWQgPSAwO1xuXG4gICAgeWllbGQgdGFrZUV2ZXJ5KFBPU1RfQUNUSVZJVFksIGZ1bmN0aW9uKiBwb3N0QWN0aXZpdHlXcmFwcGVyKGFjdGlvbikge1xuICAgICAgeWllbGQqIHBvc3RBY3Rpdml0eShkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lLCBudW1BY3Rpdml0aWVzUG9zdGVkKyssIGFjdGlvbik7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19
