'use strict';

var cov_rri33v2d1 = (function() {
  var path = '/home/guy/leo/BotFramework-WebChat/packages/core/src/sagas/postActivitySaga.js';
  var hash = '90db500b290e820747498412292cbba96ef33824';
  var global = new Function('return this')();
  var gcv = '__coverage__';
  var coverageData = {
    path: '/home/guy/leo/BotFramework-WebChat/packages/core/src/sagas/postActivitySaga.js',
    statementMap: {
      '0': {
        start: {
          line: 25,
          column: 2
        },
        end: {
          line: 25,
          column: 66
        }
      },
      '1': {
        start: {
          line: 29,
          column: 42
        },
        end: {
          line: 31,
          column: 3
        }
      },
      '2': {
        start: {
          line: 32,
          column: 79
        },
        end: {
          line: 32,
          column: 87
        }
      },
      '3': {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 60,
          column: 4
        }
      },
      '4': {
        start: {
          line: 38,
          column: 76
        },
        end: {
          line: 43,
          column: 7
        }
      },
      '5': {
        start: {
          line: 62,
          column: 2
        },
        end: {
          line: 74,
          column: 3
        }
      },
      '6': {
        start: {
          line: 63,
          column: 4
        },
        end: {
          line: 73,
          column: 6
        }
      },
      '7': {
        start: {
          line: 76,
          column: 15
        },
        end: {
          line: 76,
          column: 43
        }
      },
      '8': {
        start: {
          line: 78,
          column: 2
        },
        end: {
          line: 78,
          column: 74
        }
      },
      '9': {
        start: {
          line: 80,
          column: 2
        },
        end: {
          line: 121,
          column: 3
        }
      },
      '10': {
        start: {
          line: 84,
          column: 25
        },
        end: {
          line: 95,
          column: 6
        }
      },
      '11': {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 94,
          column: 7
        }
      },
      '12': {
        start: {
          line: 88,
          column: 12
        },
        end: {
          line: 88,
          column: 41
        }
      },
      '13': {
        start: {
          line: 89,
          column: 41
        },
        end: {
          line: 89,
          column: 49
        }
      },
      '14': {
        start: {
          line: 91,
          column: 8
        },
        end: {
          line: 93,
          column: 9
        }
      },
      '15': {
        start: {
          line: 92,
          column: 10
        },
        end: {
          line: 92,
          column: 26
        }
      },
      '16': {
        start: {
          line: 102,
          column: 24
        },
        end: {
          line: 102,
          column: 57
        }
      },
      '17': {
        start: {
          line: 106,
          column: 8
        },
        end: {
          line: 112,
          column: 6
        }
      },
      '18': {
        start: {
          line: 111,
          column: 26
        },
        end: {
          line: 111,
          column: 93
        }
      },
      '19': {
        start: {
          line: 111,
          column: 56
        },
        end: {
          line: 111,
          column: 92
        }
      },
      '20': {
        start: {
          line: 114,
          column: 4
        },
        end: {
          line: 114,
          column: 88
        }
      },
      '21': {
        start: {
          line: 116,
          column: 4
        },
        end: {
          line: 116,
          column: 81
        }
      },
      '22': {
        start: {
          line: 118,
          column: 4
        },
        end: {
          line: 120,
          column: 5
        }
      },
      '23': {
        start: {
          line: 119,
          column: 6
        },
        end: {
          line: 119,
          column: 102
        }
      },
      '24': {
        start: {
          line: 125,
          column: 2
        },
        end: {
          line: 131,
          column: 5
        }
      },
      '25': {
        start: {
          line: 126,
          column: 30
        },
        end: {
          line: 126,
          column: 31
        }
      },
      '26': {
        start: {
          line: 128,
          column: 4
        },
        end: {
          line: 130,
          column: 7
        }
      },
      '27': {
        start: {
          line: 129,
          column: 6
        },
        end: {
          line: 129,
          column: 87
        }
      }
    },
    fnMap: {
      '0': {
        name: 'getTimestamp',
        decl: {
          start: {
            line: 24,
            column: 9
          },
          end: {
            line: 24,
            column: 21
          }
        },
        loc: {
          start: {
            line: 24,
            column: 47
          },
          end: {
            line: 26,
            column: 1
          }
        },
        line: 24
      },
      '1': {
        name: 'postActivity',
        decl: {
          start: {
            line: 28,
            column: 10
          },
          end: {
            line: 28,
            column: 22
          }
        },
        loc: {
          start: {
            line: 28,
            column: 119
          },
          end: {
            line: 122,
            column: 1
          }
        },
        line: 28
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 38,
            column: 22
          },
          end: {
            line: 38,
            column: 23
          }
        },
        loc: {
          start: {
            line: 38,
            column: 76
          },
          end: {
            line: 43,
            column: 7
          }
        },
        line: 38
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 84,
            column: 30
          },
          end: {
            line: 84,
            column: 31
          }
        },
        loc: {
          start: {
            line: 84,
            column: 42
          },
          end: {
            line: 95,
            column: 5
          }
        },
        line: 84
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 111,
            column: 20
          },
          end: {
            line: 111,
            column: 21
          }
        },
        loc: {
          start: {
            line: 111,
            column: 26
          },
          end: {
            line: 111,
            column: 93
          }
        },
        line: 111
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 111,
            column: 50
          },
          end: {
            line: 111,
            column: 51
          }
        },
        loc: {
          start: {
            line: 111,
            column: 56
          },
          end: {
            line: 111,
            column: 92
          }
        },
        line: 111
      },
      '6': {
        name: 'postActivitySaga',
        decl: {
          start: {
            line: 124,
            column: 25
          },
          end: {
            line: 124,
            column: 41
          }
        },
        loc: {
          start: {
            line: 124,
            column: 44
          },
          end: {
            line: 132,
            column: 1
          }
        },
        line: 124
      },
      '7': {
        name: 'postActivityWhileConnected',
        decl: {
          start: {
            line: 125,
            column: 33
          },
          end: {
            line: 125,
            column: 59
          }
        },
        loc: {
          start: {
            line: 125,
            column: 94
          },
          end: {
            line: 131,
            column: 3
          }
        },
        line: 125
      },
      '8': {
        name: 'postActivityWrapper',
        decl: {
          start: {
            line: 128,
            column: 45
          },
          end: {
            line: 128,
            column: 64
          }
        },
        loc: {
          start: {
            line: 128,
            column: 73
          },
          end: {
            line: 130,
            column: 5
          }
        },
        line: 128
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 24,
            column: 22
          },
          end: {
            line: 24,
            column: 45
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 24,
              column: 44
            },
            end: {
              line: 24,
              column: 45
            }
          }
        ],
        line: 24
      },
      '1': {
        loc: {
          start: {
            line: 32,
            column: 36
          },
          end: {
            line: 32,
            column: 74
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 32,
              column: 72
            },
            end: {
              line: 32,
              column: 74
            }
          }
        ],
        line: 32
      },
      '2': {
        loc: {
          start: {
            line: 32,
            column: 38
          },
          end: {
            line: 32,
            column: 67
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 32,
              column: 57
            },
            end: {
              line: 32,
              column: 67
            }
          }
        ],
        line: 32
      },
      '3': {
        loc: {
          start: {
            line: 37,
            column: 6
          },
          end: {
            line: 43,
            column: 9
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 37,
              column: 6
            },
            end: {
              line: 37,
              column: 17
            }
          },
          {
            start: {
              line: 38,
              column: 6
            },
            end: {
              line: 43,
              column: 9
            }
          }
        ],
        line: 37
      },
      '4': {
        loc: {
          start: {
            line: 62,
            column: 2
          },
          end: {
            line: 74,
            column: 3
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 62,
              column: 2
            },
            end: {
              line: 74,
              column: 3
            }
          },
          {
            start: {
              line: 62,
              column: 2
            },
            end: {
              line: 74,
              column: 3
            }
          }
        ],
        line: 62
      },
      '5': {
        loc: {
          start: {
            line: 64,
            column: 10
          },
          end: {
            line: 64,
            column: 33
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 64,
              column: 10
            },
            end: {
              line: 64,
              column: 27
            }
          },
          {
            start: {
              line: 64,
              column: 31
            },
            end: {
              line: 64,
              column: 33
            }
          }
        ],
        line: 64
      },
      '6': {
        loc: {
          start: {
            line: 89,
            column: 16
          },
          end: {
            line: 89,
            column: 32
          }
        },
        type: 'default-arg',
        locations: [
          {
            start: {
              line: 89,
              column: 30
            },
            end: {
              line: 89,
              column: 32
            }
          }
        ],
        line: 89
      },
      '7': {
        loc: {
          start: {
            line: 91,
            column: 8
          },
          end: {
            line: 93,
            column: 9
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 91,
              column: 8
            },
            end: {
              line: 93,
              column: 9
            }
          },
          {
            start: {
              line: 91,
              column: 8
            },
            end: {
              line: 93,
              column: 9
            }
          }
        ],
        line: 91
      },
      '8': {
        loc: {
          start: {
            line: 91,
            column: 12
          },
          end: {
            line: 91,
            column: 67
          }
        },
        type: 'binary-expr',
        locations: [
          {
            start: {
              line: 91,
              column: 12
            },
            end: {
              line: 91,
              column: 61
            }
          },
          {
            start: {
              line: 91,
              column: 65
            },
            end: {
              line: 91,
              column: 67
            }
          }
        ],
        line: 91
      },
      '9': {
        loc: {
          start: {
            line: 118,
            column: 4
          },
          end: {
            line: 120,
            column: 5
          }
        },
        type: 'if',
        locations: [
          {
            start: {
              line: 118,
              column: 4
            },
            end: {
              line: 120,
              column: 5
            }
          },
          {
            start: {
              line: 118,
              column: 4
            },
            end: {
              line: 120,
              column: 5
            }
          }
        ],
        line: 118
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0
    },
    b: {
      '0': [0],
      '1': [0],
      '2': [0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184',
    hash: '90db500b290e820747498412292cbba96ef33824'
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return (coverage[path] = coverageData);
})();

var _interopRequireDefault = require('@babel/runtime/helpers/interopRequireDefault');

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = postActivitySaga;

var _regenerator = _interopRequireDefault(require('@babel/runtime/regenerator'));

var _toConsumableArray2 = _interopRequireDefault(require('@babel/runtime/helpers/toConsumableArray'));

var _defineProperty2 = _interopRequireDefault(require('@babel/runtime/helpers/defineProperty'));

var _effects = require('redux-saga/effects');

var _observeOnce = _interopRequireDefault(require('./effects/observeOnce'));

var _whileConnected = _interopRequireDefault(require('./effects/whileConnected'));

var _clockSkewAdjustment = _interopRequireDefault(require('../selectors/clockSkewAdjustment'));

var _combineSelectors = _interopRequireDefault(require('../selectors/combineSelectors'));

var _language = _interopRequireDefault(require('../selectors/language'));

var _sendTimeout = _interopRequireDefault(require('../selectors/sendTimeout'));

var _deleteKey = _interopRequireDefault(require('../utils/deleteKey'));

var _sleep = _interopRequireDefault(require('../utils/sleep'));

var _uniqueID = _interopRequireDefault(require('../utils/uniqueID'));

var _postActivity = require('../actions/postActivity');

var _incomingActivity = require('../actions/incomingActivity');

var _marked =
    /*#__PURE__*/
    _regenerator['default'].mark(postActivity),
  _marked2 =
    /*#__PURE__*/
    _regenerator['default'].mark(postActivitySaga);

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);
  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly)
      symbols = symbols.filter(function(sym) {
        return Object.getOwnPropertyDescriptor(object, sym).enumerable;
      });
    keys.push.apply(keys, symbols);
  }
  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    if (i % 2) {
      ownKeys(source, true).forEach(function(key) {
        (0, _defineProperty2['default'])(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(source).forEach(function(key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }
  return target;
}

function getTimestamp() {
  var clockSkewAdjustment =
    arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (cov_rri33v2d1.b[0][0]++, 0);
  cov_rri33v2d1.f[0]++;
  cov_rri33v2d1.s[0]++;
  return new Date(Date.now() + clockSkewAdjustment).toISOString();
}

function postActivity(directLine, userID, username, numActivitiesPosted, _ref) {
  var method,
    activity,
    _ref2,
    clockSkewAdjustment,
    locale,
    _ref3,
    attachments,
    _ref3$channelData,
    _ref3$channelData$cli,
    clientActivityID,
    meta,
    echoBackCall,
    sendTimeout,
    _ref7,
    echoBack;

  return _regenerator['default'].wrap(
    function postActivity$(_context2) {
      while (1) {
        switch ((_context2.prev = _context2.next)) {
          case 0:
            (method = _ref.meta.method), (activity = _ref.payload.activity);
            cov_rri33v2d1.f[1]++;
            cov_rri33v2d1.s[1]++;
            _context2.next = 5;
            return (0, _effects.select)(
              (0, _combineSelectors['default'])({
                clockSkewAdjustment: _clockSkewAdjustment['default'],
                locale: _language['default']
              })
            );

          case 5:
            _ref2 = _context2.sent;
            clockSkewAdjustment = _ref2.clockSkewAdjustment;
            locale = _ref2.locale;
            (_ref3 = (cov_rri33v2d1.s[2]++, activity)),
              (attachments = _ref3.attachments),
              (_ref3$channelData = _ref3.channelData);
            _ref3$channelData = _ref3$channelData === void 0 ? (cov_rri33v2d1.b[1][0]++, {}) : _ref3$channelData;
            (_ref3$channelData$cli = _ref3$channelData.clientActivityID),
              (clientActivityID =
                _ref3$channelData$cli === void 0
                  ? (cov_rri33v2d1.b[2][0]++, (0, _uniqueID['default'])())
                  : _ref3$channelData$cli);
            cov_rri33v2d1.s[3]++;
            activity = _objectSpread({}, (0, _deleteKey['default'])(activity, 'id'), {
              attachments:
                (cov_rri33v2d1.b[3][0]++, attachments) &&
                (cov_rri33v2d1.b[3][1]++,
                attachments.map(function(_ref4) {
                  var contentType = _ref4.contentType,
                    contentUrl = _ref4.contentUrl,
                    name = _ref4.name,
                    thumbnailUrl = _ref4.thumbnailUrl;
                  cov_rri33v2d1.f[2]++;
                  cov_rri33v2d1.s[4]++;
                  return {
                    contentType: contentType,
                    contentUrl: contentUrl,
                    name: name,
                    thumbnailUrl: thumbnailUrl
                  };
                })),
              channelData: _objectSpread(
                {
                  clientActivityID: clientActivityID,
                  // This is unskewed local timestamp for estimating clock skew.
                  clientTimestamp: getTimestamp()
                },
                (0, _deleteKey['default'])(activity.channelData, 'state')
              ),
              channelId: 'webchat',
              from: {
                id: userID,
                name: username,
                role: 'user'
              },
              locale: locale,
              // This timestamp will be replaced by Direct Line Channel in echoback.
              // We are temporarily adding this timestamp for sorting.
              timestamp: getTimestamp(clockSkewAdjustment)
            });
            cov_rri33v2d1.s[5]++;

            if (!numActivitiesPosted) {
              cov_rri33v2d1.b[4][0]++;
              cov_rri33v2d1.s[6]++;
              activity.entities = [].concat(
                (0, _toConsumableArray2['default'])(
                  (cov_rri33v2d1.b[5][0]++, activity.entities) || (cov_rri33v2d1.b[5][1]++, [])
                ),
                [
                  {
                    // TODO: [P4] Currently in v3, we send the capabilities although the client might not actually have them
                    //       We need to understand why we need to send these, and only send capabilities the client have
                    requiresBotState: true,
                    supportsListening: true,
                    supportsTts: true,
                    type: 'ClientCapabilities'
                  }
                ]
              );
            } else {
              cov_rri33v2d1.b[4][1]++;
            }

            meta =
              (cov_rri33v2d1.s[7]++,
              {
                clientActivityID: clientActivityID,
                method: method
              });
            cov_rri33v2d1.s[8]++;
            _context2.next = 19;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_PENDING,
              meta: meta,
              payload: {
                activity: activity
              }
            });

          case 19:
            cov_rri33v2d1.s[9]++;
            _context2.prev = 20;
            // Quirks: We might receive INCOMING_ACTIVITY before the postActivity call completed
            //         So, we setup expectation first, then postActivity afterward
            echoBackCall =
              (cov_rri33v2d1.s[10]++,
              (0, _effects.call)(
                /*#__PURE__*/
                _regenerator['default'].mark(function _callee() {
                  var _ref5, _activity, _ref6, _ref6$channelData, channelData, id;

                  return _regenerator['default'].wrap(function _callee$(_context) {
                    while (1) {
                      switch ((_context.prev = _context.next)) {
                        case 0:
                          cov_rri33v2d1.f[3]++;
                          cov_rri33v2d1.s[11]++;

                        case 2:
                          cov_rri33v2d1.s[12]++;
                          _context.next = 5;
                          return (0, _effects.take)(_incomingActivity.INCOMING_ACTIVITY);

                        case 5:
                          _ref5 = _context.sent;
                          _activity = _ref5.payload.activity;
                          (_ref6 = (cov_rri33v2d1.s[13]++, _activity)),
                            (_ref6$channelData = _ref6.channelData),
                            (channelData =
                              _ref6$channelData === void 0 ? (cov_rri33v2d1.b[6][0]++, {}) : _ref6$channelData),
                            (id = _ref6.id);
                          cov_rri33v2d1.s[14]++;

                          if (
                            !(
                              (cov_rri33v2d1.b[8][0]++, channelData.clientActivityID === clientActivityID) &&
                              (cov_rri33v2d1.b[8][1]++, id)
                            )
                          ) {
                            _context.next = 15;
                            break;
                          }

                          cov_rri33v2d1.b[7][0]++;
                          cov_rri33v2d1.s[15]++;
                          return _context.abrupt('return', _activity);

                        case 15:
                          cov_rri33v2d1.b[7][1]++;

                        case 16:
                          _context.next = 2;
                          break;

                        case 18:
                        case 'end':
                          return _context.stop();
                      }
                    }
                  }, _callee);
                })
              )); // Timeout could be due to either:
            // - Post activity call may take too long time to complete
            //   - Direct Line service only respond on HTTP after bot respond to Direct Line
            // - Activity may take too long time to echo back

            cov_rri33v2d1.s[16]++;
            _context2.next = 25;
            return (0, _effects.select)(_sendTimeout['default']);

          case 25:
            sendTimeout = _context2.sent;
            cov_rri33v2d1.s[17]++;
            _context2.next = 29;
            return (0, _effects.race)({
              send: (0, _effects.all)({
                echoBack: echoBackCall,
                postActivity: (0, _observeOnce['default'])(directLine.postActivity(activity))
              }),
              timeout: (0, _effects.call)(function() {
                cov_rri33v2d1.f[4]++;
                cov_rri33v2d1.s[18]++;
                return (0, _sleep['default'])(sendTimeout).then(function() {
                  cov_rri33v2d1.f[5]++;
                  cov_rri33v2d1.s[19]++;
                  return Promise.reject(new Error('timeout'));
                });
              })
            });

          case 29:
            _ref7 = _context2.sent;
            echoBack = _ref7.send.echoBack;
            cov_rri33v2d1.s[20]++;
            _context2.next = 34;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_FULFILLED,
              meta: meta,
              payload: {
                activity: echoBack
              }
            });

          case 34:
            _context2.next = 41;
            break;

          case 36:
            _context2.prev = 36;
            _context2.t0 = _context2['catch'](20);
            cov_rri33v2d1.s[21]++;
            _context2.next = 41;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_REJECTED,
              error: true,
              meta: meta,
              payload: _context2.t0
            });

          case 41:
            _context2.prev = 41;
            cov_rri33v2d1.s[22]++;
            _context2.next = 45;
            return (0, _effects.cancelled)();

          case 45:
            if (!_context2.sent) {
              _context2.next = 52;
              break;
            }

            cov_rri33v2d1.b[9][0]++;
            cov_rri33v2d1.s[23]++;
            _context2.next = 50;
            return (0, _effects.put)({
              type: _postActivity.POST_ACTIVITY_REJECTED,
              error: true,
              meta: meta,
              payload: new Error('cancelled')
            });

          case 50:
            _context2.next = 53;
            break;

          case 52:
            cov_rri33v2d1.b[9][1]++;

          case 53:
            return _context2.finish(41);

          case 54:
          case 'end':
            return _context2.stop();
        }
      }
    },
    _marked,
    null,
    [[20, 36, 41, 54]]
  );
}

function postActivitySaga() {
  return _regenerator['default'].wrap(function postActivitySaga$(_context5) {
    while (1) {
      switch ((_context5.prev = _context5.next)) {
        case 0:
          cov_rri33v2d1.f[6]++;
          cov_rri33v2d1.s[24]++;
          _context5.next = 4;
          return (0, _whileConnected['default'])(
            /*#__PURE__*/
            _regenerator['default'].mark(function postActivityWhileConnected(_ref8) {
              var directLine, userID, username, numActivitiesPosted;
              return _regenerator['default'].wrap(function postActivityWhileConnected$(_context4) {
                while (1) {
                  switch ((_context4.prev = _context4.next)) {
                    case 0:
                      (directLine = _ref8.directLine), (userID = _ref8.userID), (username = _ref8.username);
                      cov_rri33v2d1.f[7]++;
                      numActivitiesPosted = (cov_rri33v2d1.s[25]++, 0);
                      cov_rri33v2d1.s[26]++;
                      _context4.next = 6;
                      return (0, _effects.takeEvery)(
                        _postActivity.POST_ACTIVITY,
                        /*#__PURE__*/
                        _regenerator['default'].mark(function postActivityWrapper(action) {
                          return _regenerator['default'].wrap(function postActivityWrapper$(_context3) {
                            while (1) {
                              switch ((_context3.prev = _context3.next)) {
                                case 0:
                                  cov_rri33v2d1.f[8]++;
                                  cov_rri33v2d1.s[27]++;
                                  return _context3.delegateYield(
                                    postActivity(directLine, userID, username, numActivitiesPosted++, action),
                                    't0',
                                    3
                                  );

                                case 3:
                                case 'end':
                                  return _context3.stop();
                              }
                            }
                          }, postActivityWrapper);
                        })
                      );

                    case 6:
                    case 'end':
                      return _context4.stop();
                  }
                }
              }, postActivityWhileConnected);
            })
          );

        case 4:
        case 'end':
          return _context5.stop();
      }
    }
  }, _marked2);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zYWdhcy9wb3N0QWN0aXZpdHlTYWdhLmpzIl0sIm5hbWVzIjpbInBvc3RBY3Rpdml0eSIsInBvc3RBY3Rpdml0eVNhZ2EiLCJnZXRUaW1lc3RhbXAiLCJjbG9ja1NrZXdBZGp1c3RtZW50IiwiRGF0ZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiZGlyZWN0TGluZSIsInVzZXJJRCIsInVzZXJuYW1lIiwibnVtQWN0aXZpdGllc1Bvc3RlZCIsIm1ldGhvZCIsIm1ldGEiLCJhY3Rpdml0eSIsInBheWxvYWQiLCJjbG9ja1NrZXdBZGp1c3RtZW50U2VsZWN0b3IiLCJsb2NhbGUiLCJsYW5ndWFnZVNlbGVjdG9yIiwiYXR0YWNobWVudHMiLCJjaGFubmVsRGF0YSIsImNsaWVudEFjdGl2aXR5SUQiLCJtYXAiLCJjb250ZW50VHlwZSIsImNvbnRlbnRVcmwiLCJuYW1lIiwidGh1bWJuYWlsVXJsIiwiY2xpZW50VGltZXN0YW1wIiwiY2hhbm5lbElkIiwiZnJvbSIsImlkIiwicm9sZSIsInRpbWVzdGFtcCIsImVudGl0aWVzIiwicmVxdWlyZXNCb3RTdGF0ZSIsInN1cHBvcnRzTGlzdGVuaW5nIiwic3VwcG9ydHNUdHMiLCJ0eXBlIiwiUE9TVF9BQ1RJVklUWV9QRU5ESU5HIiwiZWNob0JhY2tDYWxsIiwiSU5DT01JTkdfQUNUSVZJVFkiLCJzZW5kVGltZW91dFNlbGVjdG9yIiwic2VuZFRpbWVvdXQiLCJzZW5kIiwiZWNob0JhY2siLCJ0aW1lb3V0IiwidGhlbiIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciIsIlBPU1RfQUNUSVZJVFlfRlVMRklMTEVEIiwiUE9TVF9BQ1RJVklUWV9SRUpFQ1RFRCIsImVycm9yIiwicG9zdEFjdGl2aXR5V2hpbGVDb25uZWN0ZWQiLCJQT1NUX0FDVElWSVRZIiwicG9zdEFjdGl2aXR5V3JhcHBlciIsImFjdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNB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O0FBQUE7O0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFnR2UsU0FBVS9DLGdCQUFWO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDYixpQkFBTTtBQUFBO0FBQUEsdUNBQWUsU0FBVW1ELDBCQUFWO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUF1QzdDLG9CQUFBQSxVQUF2QyxTQUF1Q0EsVUFBdkMsRUFBbURDLE1BQW5ELFNBQW1EQSxNQUFuRCxFQUEyREMsUUFBM0QsU0FBMkRBLFFBQTNEO0FBQUE7QUFDZkMsb0JBQUFBLG1CQURlLDJCQUNPLENBRFA7QUFBQTtBQUFBO0FBR25CLDJCQUFNLHdCQUFVMkMsMkJBQVY7QUFBQTtBQUFBLGlEQUF5QixTQUFVQyxtQkFBVixDQUE4QkMsTUFBOUI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDN0IsNkRBQU92RCxZQUFZLENBQUNPLFVBQUQsRUFBYUMsTUFBYixFQUFxQkMsUUFBckIsRUFBK0JDLG1CQUFtQixFQUFsRCxFQUFzRDZDLE1BQXRELENBQW5COztBQUQ2QjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEseUJBQVVELG1CQUFWO0FBQUEscUJBQXpCLEVBQU47O0FBSG1CO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUFVRiwwQkFBVjtBQUFBLFdBQWYsRUFBTjs7QUFEYTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFsbCwgY2FsbCwgY2FuY2VsbGVkLCBwdXQsIHJhY2UsIHNlbGVjdCwgdGFrZSwgdGFrZUV2ZXJ5IH0gZnJvbSAncmVkdXgtc2FnYS9lZmZlY3RzJztcblxuaW1wb3J0IG9ic2VydmVPbmNlIGZyb20gJy4vZWZmZWN0cy9vYnNlcnZlT25jZSc7XG5pbXBvcnQgd2hpbGVDb25uZWN0ZWQgZnJvbSAnLi9lZmZlY3RzL3doaWxlQ29ubmVjdGVkJztcblxuaW1wb3J0IGNsb2NrU2tld0FkanVzdG1lbnRTZWxlY3RvciBmcm9tICcuLi9zZWxlY3RvcnMvY2xvY2tTa2V3QWRqdXN0bWVudCc7XG5pbXBvcnQgY29tYmluZVNlbGVjdG9ycyBmcm9tICcuLi9zZWxlY3RvcnMvY29tYmluZVNlbGVjdG9ycyc7XG5pbXBvcnQgbGFuZ3VhZ2VTZWxlY3RvciBmcm9tICcuLi9zZWxlY3RvcnMvbGFuZ3VhZ2UnO1xuaW1wb3J0IHNlbmRUaW1lb3V0U2VsZWN0b3IgZnJvbSAnLi4vc2VsZWN0b3JzL3NlbmRUaW1lb3V0JztcblxuaW1wb3J0IGRlbGV0ZUtleSBmcm9tICcuLi91dGlscy9kZWxldGVLZXknO1xuaW1wb3J0IHNsZWVwIGZyb20gJy4uL3V0aWxzL3NsZWVwJztcbmltcG9ydCB1bmlxdWVJRCBmcm9tICcuLi91dGlscy91bmlxdWVJRCc7XG5cbmltcG9ydCB7XG4gIFBPU1RfQUNUSVZJVFksXG4gIFBPU1RfQUNUSVZJVFlfRlVMRklMTEVELFxuICBQT1NUX0FDVElWSVRZX1BFTkRJTkcsXG4gIFBPU1RfQUNUSVZJVFlfUkVKRUNURURcbn0gZnJvbSAnLi4vYWN0aW9ucy9wb3N0QWN0aXZpdHknO1xuXG5pbXBvcnQgeyBJTkNPTUlOR19BQ1RJVklUWSB9IGZyb20gJy4uL2FjdGlvbnMvaW5jb21pbmdBY3Rpdml0eSc7XG5cbmZ1bmN0aW9uIGdldFRpbWVzdGFtcChjbG9ja1NrZXdBZGp1c3RtZW50ID0gMCkge1xuICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSArIGNsb2NrU2tld0FkanVzdG1lbnQpLnRvSVNPU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uKiBwb3N0QWN0aXZpdHkoZGlyZWN0TGluZSwgdXNlcklELCB1c2VybmFtZSwgbnVtQWN0aXZpdGllc1Bvc3RlZCwgeyBtZXRhOiB7IG1ldGhvZCB9LCBwYXlsb2FkOiB7IGFjdGl2aXR5IH0gfSkge1xuICBjb25zdCB7IGNsb2NrU2tld0FkanVzdG1lbnQsIGxvY2FsZSB9ID0geWllbGQgc2VsZWN0KFxuICAgIGNvbWJpbmVTZWxlY3RvcnMoeyBjbG9ja1NrZXdBZGp1c3RtZW50OiBjbG9ja1NrZXdBZGp1c3RtZW50U2VsZWN0b3IsIGxvY2FsZTogbGFuZ3VhZ2VTZWxlY3RvciB9KVxuICApO1xuICBjb25zdCB7IGF0dGFjaG1lbnRzLCBjaGFubmVsRGF0YTogeyBjbGllbnRBY3Rpdml0eUlEID0gdW5pcXVlSUQoKSB9ID0ge30gfSA9IGFjdGl2aXR5O1xuXG4gIGFjdGl2aXR5ID0ge1xuICAgIC4uLmRlbGV0ZUtleShhY3Rpdml0eSwgJ2lkJyksXG4gICAgYXR0YWNobWVudHM6XG4gICAgICBhdHRhY2htZW50cyAmJlxuICAgICAgYXR0YWNobWVudHMubWFwKCh7IGNvbnRlbnRUeXBlLCBjb250ZW50VXJsLCBuYW1lLCB0aHVtYm5haWxVcmwgfSkgPT4gKHtcbiAgICAgICAgY29udGVudFR5cGUsXG4gICAgICAgIGNvbnRlbnRVcmwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHRodW1ibmFpbFVybFxuICAgICAgfSkpLFxuICAgIGNoYW5uZWxEYXRhOiB7XG4gICAgICBjbGllbnRBY3Rpdml0eUlELFxuICAgICAgLy8gVGhpcyBpcyB1bnNrZXdlZCBsb2NhbCB0aW1lc3RhbXAgZm9yIGVzdGltYXRpbmcgY2xvY2sgc2tldy5cbiAgICAgIGNsaWVudFRpbWVzdGFtcDogZ2V0VGltZXN0YW1wKCksXG4gICAgICAuLi5kZWxldGVLZXkoYWN0aXZpdHkuY2hhbm5lbERhdGEsICdzdGF0ZScpXG4gICAgfSxcbiAgICBjaGFubmVsSWQ6ICd3ZWJjaGF0JyxcbiAgICBmcm9tOiB7XG4gICAgICBpZDogdXNlcklELFxuICAgICAgbmFtZTogdXNlcm5hbWUsXG4gICAgICByb2xlOiAndXNlcidcbiAgICB9LFxuICAgIGxvY2FsZSxcbiAgICAvLyBUaGlzIHRpbWVzdGFtcCB3aWxsIGJlIHJlcGxhY2VkIGJ5IERpcmVjdCBMaW5lIENoYW5uZWwgaW4gZWNob2JhY2suXG4gICAgLy8gV2UgYXJlIHRlbXBvcmFyaWx5IGFkZGluZyB0aGlzIHRpbWVzdGFtcCBmb3Igc29ydGluZy5cbiAgICB0aW1lc3RhbXA6IGdldFRpbWVzdGFtcChjbG9ja1NrZXdBZGp1c3RtZW50KVxuICB9O1xuXG4gIGlmICghbnVtQWN0aXZpdGllc1Bvc3RlZCkge1xuICAgIGFjdGl2aXR5LmVudGl0aWVzID0gW1xuICAgICAgLi4uKGFjdGl2aXR5LmVudGl0aWVzIHx8IFtdKSxcbiAgICAgIHtcbiAgICAgICAgLy8gVE9ETzogW1A0XSBDdXJyZW50bHkgaW4gdjMsIHdlIHNlbmQgdGhlIGNhcGFiaWxpdGllcyBhbHRob3VnaCB0aGUgY2xpZW50IG1pZ2h0IG5vdCBhY3R1YWxseSBoYXZlIHRoZW1cbiAgICAgICAgLy8gICAgICAgV2UgbmVlZCB0byB1bmRlcnN0YW5kIHdoeSB3ZSBuZWVkIHRvIHNlbmQgdGhlc2UsIGFuZCBvbmx5IHNlbmQgY2FwYWJpbGl0aWVzIHRoZSBjbGllbnQgaGF2ZVxuICAgICAgICByZXF1aXJlc0JvdFN0YXRlOiB0cnVlLFxuICAgICAgICBzdXBwb3J0c0xpc3RlbmluZzogdHJ1ZSxcbiAgICAgICAgc3VwcG9ydHNUdHM6IHRydWUsXG4gICAgICAgIHR5cGU6ICdDbGllbnRDYXBhYmlsaXRpZXMnXG4gICAgICB9XG4gICAgXTtcbiAgfVxuXG4gIGNvbnN0IG1ldGEgPSB7IGNsaWVudEFjdGl2aXR5SUQsIG1ldGhvZCB9O1xuXG4gIHlpZWxkIHB1dCh7IHR5cGU6IFBPU1RfQUNUSVZJVFlfUEVORElORywgbWV0YSwgcGF5bG9hZDogeyBhY3Rpdml0eSB9IH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gUXVpcmtzOiBXZSBtaWdodCByZWNlaXZlIElOQ09NSU5HX0FDVElWSVRZIGJlZm9yZSB0aGUgcG9zdEFjdGl2aXR5IGNhbGwgY29tcGxldGVkXG4gICAgLy8gICAgICAgICBTbywgd2Ugc2V0dXAgZXhwZWN0YXRpb24gZmlyc3QsIHRoZW4gcG9zdEFjdGl2aXR5IGFmdGVyd2FyZFxuXG4gICAgY29uc3QgZWNob0JhY2tDYWxsID0gY2FsbChmdW5jdGlvbiooKSB7XG4gICAgICBmb3IgKDs7KSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBwYXlsb2FkOiB7IGFjdGl2aXR5IH1cbiAgICAgICAgfSA9IHlpZWxkIHRha2UoSU5DT01JTkdfQUNUSVZJVFkpO1xuICAgICAgICBjb25zdCB7IGNoYW5uZWxEYXRhID0ge30sIGlkIH0gPSBhY3Rpdml0eTtcblxuICAgICAgICBpZiAoY2hhbm5lbERhdGEuY2xpZW50QWN0aXZpdHlJRCA9PT0gY2xpZW50QWN0aXZpdHlJRCAmJiBpZCkge1xuICAgICAgICAgIHJldHVybiBhY3Rpdml0eTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVGltZW91dCBjb3VsZCBiZSBkdWUgdG8gZWl0aGVyOlxuICAgIC8vIC0gUG9zdCBhY3Rpdml0eSBjYWxsIG1heSB0YWtlIHRvbyBsb25nIHRpbWUgdG8gY29tcGxldGVcbiAgICAvLyAgIC0gRGlyZWN0IExpbmUgc2VydmljZSBvbmx5IHJlc3BvbmQgb24gSFRUUCBhZnRlciBib3QgcmVzcG9uZCB0byBEaXJlY3QgTGluZVxuICAgIC8vIC0gQWN0aXZpdHkgbWF5IHRha2UgdG9vIGxvbmcgdGltZSB0byBlY2hvIGJhY2tcblxuICAgIGNvbnN0IHNlbmRUaW1lb3V0ID0geWllbGQgc2VsZWN0KHNlbmRUaW1lb3V0U2VsZWN0b3IpO1xuXG4gICAgY29uc3Qge1xuICAgICAgc2VuZDogeyBlY2hvQmFjayB9XG4gICAgfSA9IHlpZWxkIHJhY2Uoe1xuICAgICAgc2VuZDogYWxsKHtcbiAgICAgICAgZWNob0JhY2s6IGVjaG9CYWNrQ2FsbCxcbiAgICAgICAgcG9zdEFjdGl2aXR5OiBvYnNlcnZlT25jZShkaXJlY3RMaW5lLnBvc3RBY3Rpdml0eShhY3Rpdml0eSkpXG4gICAgICB9KSxcbiAgICAgIHRpbWVvdXQ6IGNhbGwoKCkgPT4gc2xlZXAoc2VuZFRpbWVvdXQpLnRoZW4oKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCd0aW1lb3V0JykpKSlcbiAgICB9KTtcblxuICAgIHlpZWxkIHB1dCh7IHR5cGU6IFBPU1RfQUNUSVZJVFlfRlVMRklMTEVELCBtZXRhLCBwYXlsb2FkOiB7IGFjdGl2aXR5OiBlY2hvQmFjayB9IH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB5aWVsZCBwdXQoeyB0eXBlOiBQT1NUX0FDVElWSVRZX1JFSkVDVEVELCBlcnJvcjogdHJ1ZSwgbWV0YSwgcGF5bG9hZDogZXJyIH0pO1xuICB9IGZpbmFsbHkge1xuICAgIGlmICh5aWVsZCBjYW5jZWxsZWQoKSkge1xuICAgICAgeWllbGQgcHV0KHsgdHlwZTogUE9TVF9BQ1RJVklUWV9SRUpFQ1RFRCwgZXJyb3I6IHRydWUsIG1ldGEsIHBheWxvYWQ6IG5ldyBFcnJvcignY2FuY2VsbGVkJykgfSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKiBwb3N0QWN0aXZpdHlTYWdhKCkge1xuICB5aWVsZCB3aGlsZUNvbm5lY3RlZChmdW5jdGlvbiogcG9zdEFjdGl2aXR5V2hpbGVDb25uZWN0ZWQoeyBkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lIH0pIHtcbiAgICBsZXQgbnVtQWN0aXZpdGllc1Bvc3RlZCA9IDA7XG5cbiAgICB5aWVsZCB0YWtlRXZlcnkoUE9TVF9BQ1RJVklUWSwgZnVuY3Rpb24qIHBvc3RBY3Rpdml0eVdyYXBwZXIoYWN0aW9uKSB7XG4gICAgICB5aWVsZCogcG9zdEFjdGl2aXR5KGRpcmVjdExpbmUsIHVzZXJJRCwgdXNlcm5hbWUsIG51bUFjdGl2aXRpZXNQb3N0ZWQrKywgYWN0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG59XG4iXX0=
